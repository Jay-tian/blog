!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=32)}([function(t,e){var n=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)},function(t,e,n){t.exports=!n(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=jQuery},function(t,e,n){t.exports={default:n(34),__esModule:!0}},function(t,e,n){var i=n(2),r=n(0),o=n(36),s=n(38),a=n(9),u="prototype",c=function(t,e,n){var l,h,f,p=t&c.F,d=t&c.G,g=t&c.S,m=t&c.P,v=t&c.B,y=t&c.W,w=d?r:r[e]||(r[e]={}),b=w[u],x=d?i:g?i[e]:(i[e]||{})[u];for(l in d&&(n=e),n)(h=!p&&x&&void 0!==x[l])&&a(w,l)||(f=h?x[l]:n[l],w[l]=d&&"function"!=typeof x[l]?n[l]:v&&h?o(f,i):y&&x[l]==f?function(t){var e=function(e,n,i){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,i)}return t.apply(this,arguments)};return e[u]=t[u],e}(f):m&&"function"==typeof f?o(Function.call,f):f,m&&((w.virtual||(w.virtual={}))[l]=f,t&c.R&&b&&!b[l]&&s(b,l,f)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,e,n){var i=n(39),r=n(40),o=n(42),s=Object.defineProperty;e.f=n(1)?Object.defineProperty:function(t,e,n){if(i(t),e=o(e,!0),i(n),r)try{return s(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){var i=n(11),r=n(12);t.exports=function(t){return i(r(t))}},function(t,e,n){var i=n(47);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){var n=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?i:n)(t)}},,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";var i=$("#article"),r=n(33),o=n(60);editormd({id:"content",path:"/dist/js/libs/editor.md/lib/",height:"100%",width:"100%",imageUpload:!0,saveHTMLToTextarea:!0,imageUploadURL:i.data("imageSave")}),r().on("uploadSuccess",function(t,e){$("#cover").val(e.url),$("#uploader-list").html('<img id="articleCover" width="200" class="mb2 img-responsive" src="'+e.url+'" />'),$("#crop").removeClass("hidden")}),i.validate({rules:{contentMd:{required:!0},title:{required:!0,minlength:5,maxlength:25},subTitle:{required:!0,minlength:10,maxlength:50}},messages:{subTitle:{minlength:"不能小于10个字符",maxlength:"不能大于50个字符"},title:{minlength:"不能小于5个字符",maxlength:"不能大于25个字符"}}}),$("#crop").on("click",function(){var t=$(this);new o($(t.data("target")),{aspectRatio:t.data("rate"),url:t.data("cropperUrl")},function(e){$("#cover").val(e.path),t.data("save")&&$.post(t.data("save"),{cover:e.path},function(){})})})},function(t,e,n){"use strict";var i,r=(i=n(6))&&i.__esModule?i:{default:i},o=n(59);t.exports=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return t=(0,r.default)({fileSizeLimit:2097152,auto:!0,server:window.app.imageUploadUrl,pick:"#filePicker",accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png,ico",mimeTypes:"image/*"}},t),o.create(t)}},function(t,e,n){n(35),t.exports=n(0).Object.assign},function(t,e,n){var i=n(7);i(i.S+i.F,"Object",{assign:n(44)})},function(t,e,n){var i=n(37);t.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){var i=n(8),r=n(43);t.exports=n(1)?function(t,e,n){return i.f(t,e,r(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var i=n(3);t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},function(t,e,n){t.exports=!n(1)&&!n(4)(function(){return 7!=Object.defineProperty(n(41)("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){var i=n(3),r=n(2).document,o=i(r)&&i(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},function(t,e,n){var i=n(3);t.exports=function(t,e){if(!i(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!i(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){"use strict";var i=n(45),r=n(56),o=n(57),s=n(58),a=n(11),u=Object.assign;t.exports=!u||n(4)(function(){var t={},e={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(t){e[t]=t}),7!=u({},t)[n]||Object.keys(u({},e)).join("")!=i})?function(t,e){for(var n=s(t),u=arguments.length,c=1,l=r.f,h=o.f;c<u;)for(var f,p=a(arguments[c++]),d=l?i(p).concat(l(p)):i(p),g=d.length,m=0;m<g;)h.call(p,f=d[m++])&&(n[f]=p[f]);return n}:u},function(t,e,n){var i=n(46),r=n(55);t.exports=Object.keys||function(t){return i(t,r)}},function(t,e,n){var i=n(9),r=n(10),o=n(48)(!1),s=n(51)("IE_PROTO");t.exports=function(t,e){var n,a=r(t),u=0,c=[];for(n in a)n!=s&&i(a,n)&&c.push(n);for(;e.length>u;)i(a,n=e[u++])&&(~o(c,n)||c.push(n));return c}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e,n){var i=n(10),r=n(49),o=n(50);t.exports=function(t){return function(e,n,s){var a,u=i(e),c=r(u.length),l=o(s,c);if(t&&n!=n){for(;l<c;)if((a=u[l++])!=a)return!0}else for(;l<c;l++)if((t||l in u)&&u[l]===n)return t||l||0;return!t&&-1}}},function(t,e,n){var i=n(13),r=Math.min;t.exports=function(t){return 0<t?r(i(t),9007199254740991):0}},function(t,e,n){var i=n(13),r=Math.max,o=Math.min;t.exports=function(t,e){return(t=i(t))<0?r(t+e,0):o(t,e)}},function(t,e,n){var i=n(52)("keys"),r=n(54);t.exports=function(t){return i[t]||(i[t]=r(t))}},function(t,e,n){var i=n(0),r=n(2),o="__core-js_shared__",s=r[o]||(r[o]={});(t.exports=function(t,e){return s[t]||(s[t]=void 0!==e?e:{})})("versions",[]).push({version:i.version,mode:n(53)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},function(t,e){t.exports=!0},function(t,e){var n=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+i).toString(36))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,n){var i=n(12);t.exports=function(t){return Object(i(t))}},function(t,e,n){var i,r,o,s,a,u,c,l,h,f,p=n(5);t.exports=(i=window,u={},c=function(t,e){var n,i,r;if("string"==typeof t)return f(t);for(n=[],i=t.length,r=0;r<i;r++)n.push(f(t[r]));return e.apply(null,n)},l=function(t,e,n){2===arguments.length&&(n=e,e=null),c(e||[],function(){h(t,n,arguments)})},h=function(t,e,n){var i,r={exports:e};"function"==typeof e&&(n.length||(n=[c,r.exports,r]),void 0!==(i=e.apply(null,n))&&(r.exports=i)),u[t]=r.exports},f=function(t){var e=u[t]||i[t];if(!e)throw new Error("`"+t+"` is undefined");return e},r=p,i.__dollar=r,function(t){var e,n,i,r,o,s;for(e in s=function(t){return t&&t.charAt(0).toUpperCase()+t.substr(1)},u)if(n=t,u.hasOwnProperty(e)){for(o=s((i=e.split("/")).pop());r=s(i.shift());)n[r]=n[r]||{},n=n[r];n[o]=u[e]}return t}((o=i,a=c,(s=l)("dollar-third",[],function(){var t=o.require,e=o.__dollar||o.jQuery||o.Zepto||t("jquery")||t("zepto");if(!e)throw new Error("jQuery or Zepto not found!");return e}),s("dollar",["dollar-third"],function(t){return t}),s("promise-third",["dollar"],function(t){return{Deferred:t.Deferred,when:t.when,isPromise:function(t){return t&&"function"==typeof t.then}}}),s("promise",["promise-third"],function(t){return t}),s("base",["dollar","promise"],function(t,e){var n,i,r,s,a,u,c,l,h,f,p,d,g,m,v=function(){},y=Function.call;function w(t,e){return function(){return t.apply(e,arguments)}}return{version:"0.1.6",$:t,Deferred:e.Deferred,isPromise:e.isPromise,when:e.when,browser:(c=navigator.userAgent,l={},h=c.match(/WebKit\/([\d.]+)/),f=c.match(/Chrome\/([\d.]+)/)||c.match(/CriOS\/([\d.]+)/),p=c.match(/MSIE\s([\d\.]+)/)||c.match(/(?:trident)(?:.*rv:([\w.]+))?/i),d=c.match(/Firefox\/([\d.]+)/),g=c.match(/Safari\/([\d.]+)/),m=c.match(/OPR\/([\d.]+)/),h&&(l.webkit=parseFloat(h[1])),f&&(l.chrome=parseFloat(f[1])),p&&(l.ie=parseFloat(p[1])),d&&(l.firefox=parseFloat(d[1])),g&&(l.safari=parseFloat(g[1])),m&&(l.opera=parseFloat(m[1])),l),os:(r=navigator.userAgent,s={},a=r.match(/(?:Android);?[\s\/]+([\d.]+)?/),u=r.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/),a&&(s.android=parseFloat(a[1])),u&&(s.ios=parseFloat(u[1].replace(/_/g,"."))),s),inherits:function(e,n,i){var r,o,s;return"function"==typeof n?(r=n,n=null):r=n&&n.hasOwnProperty("constructor")?n.constructor:function(){return e.apply(this,arguments)},t.extend(!0,r,e,i||{}),r.__super__=e.prototype,r.prototype=(o=e.prototype,Object.create?Object.create(o):((s=function(){}).prototype=o,new s)),n&&t.extend(!0,r.prototype,n),r},noop:v,bindFn:w,log:o.console?w(console.log,console):v,nextTick:function(t){setTimeout(t,1)},slice:(i=[].slice,function(){return y.apply(i,arguments)}),guid:(n=0,function(t){for(var e=(+new Date).toString(32),i=0;i<5;i++)e+=Math.floor(65535*Math.random()).toString(32);return(t||"wu_")+e+(n++).toString(32)}),formatSize:function(t,e,n){var i;for(n=n||["B","K","M","G","TB"];(i=n.shift())&&1024<t;)t/=1024;return("B"===i?t:t.toFixed(e||2))+i}}}),s("mediator",["base"],function(t){var e,n=t.$,i=[].slice,r=/\s+/;function o(t,e,i,r){return n.grep(t,function(t){return t&&(!e||t.e===e)&&(!i||t.cb===i||t.cb._cb===i)&&(!r||t.ctx===r)})}function s(t,e,i){n.each((t||"").split(r),function(t,n){i(n,e)})}function a(t,e){for(var n,i=!1,r=-1,o=t.length;++r<o;)if(!1===(n=t[r]).cb.apply(n.ctx2,e)){i=!0;break}return!i}return e={on:function(t,e,n){var i,r=this;return e&&(i=this._events||(this._events=[]),s(t,e,function(t,e){var o={e:t};o.cb=e,o.ctx=n,o.ctx2=n||r,o.id=i.length,i.push(o)})),this},once:function(t,e,n){var i=this;return e&&s(t,e,function(t,e){var r=function(){return i.off(t,r),e.apply(n||i,arguments)};r._cb=e,i.on(t,r,n)}),i},off:function(t,e,i){var r=this._events;return r&&(t||e||i?s(t,e,function(t,e){n.each(o(r,t,e,i),function(){delete r[this.id]})}):this._events=[]),this},trigger:function(t){var e,n,r;return this._events&&t?(e=i.call(arguments,1),n=o(this._events,t),r=o(this._events,"all"),a(n,e)&&a(r,arguments)):this}},n.extend({installTo:function(t){return n.extend(t,e)}},e)}),s("uploader",["base","mediator"],function(t,e){var n=t.$;function i(t){this.options=n.extend(!0,{},i.options,t),this._init(this.options)}return i.options={},e.installTo(i.prototype),n.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(t,e){i.prototype[t]=function(){return this.request(e,arguments)}}),n.extend(i.prototype,{state:"pending",_init:function(t){var e=this;e.request("init",t,function(){e.state="ready",e.trigger("ready")})},option:function(t,e){var i=this.options;if(!(1<arguments.length))return t?i[t]:i;n.isPlainObject(e)&&n.isPlainObject(i[t])?n.extend(i[t],e):i[t]=e},getStats:function(){var t=this.request("get-stats");return t?{successNum:t.numOfSuccess,progressNum:t.numOfProgress,cancelNum:t.numOfCancel,invalidNum:t.numOfInvalid,uploadFailNum:t.numOfUploadFailed,queueNum:t.numOfQueue,interruptNum:t.numofInterrupt}:{}},trigger:function(t){var i=[].slice.call(arguments,1),r=this.options,o="on"+t.substring(0,1).toUpperCase()+t.substring(1);return!(!1===e.trigger.apply(this,arguments)||n.isFunction(r[o])&&!1===r[o].apply(this,i)||n.isFunction(this[o])&&!1===this[o].apply(this,i)||!1===e.trigger.apply(e,[this,t].concat(i)))},destroy:function(){this.request("destroy",arguments),this.off()},request:t.noop}),t.create=i.create=function(t){return new i(t)},t.Uploader=i}),s("runtime/runtime",["base","mediator"],function(t,e){var n=t.$,i={},r=function(t){for(var e in t)if(t.hasOwnProperty(e))return e;return null};function o(e){this.options=n.extend({container:document.body},e),this.uid=t.guid("rt_")}return n.extend(o.prototype,{getContainer:function(){var t,e,i=this.options;return this._container?this._container:(t=n(i.container||document.body),(e=n(document.createElement("div"))).attr("id","rt_"+this.uid),e.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),t.append(e),t.addClass("webuploader-container"),this._container=e,this._parent=t,e)},init:t.noop,exec:t.noop,destroy:function(){this._container&&this._container.remove(),this._parent&&this._parent.removeClass("webuploader-container"),this.off()}}),o.orders="html5,flash",o.addRuntime=function(t,e){i[t]=e},o.hasRuntime=function(t){return!!(t?i[t]:r(i))},o.create=function(t,e){var s;if(e=e||o.orders,n.each(e.split(/\s*,\s*/g),function(){if(i[this])return s=this,!1}),!(s=s||r(i)))throw new Error("Runtime Error");return new i[s](t)},e.installTo(o.prototype),o}),s("runtime/client",["base","mediator","runtime/runtime"],function(t,e,n){var i,r;function o(e,r){var o,s,a=t.Deferred();this.uid=t.guid("client_"),this.runtimeReady=function(t){return a.done(t)},this.connectRuntime=function(e,s){if(o)throw new Error("already connected!");return a.done(s),"string"==typeof e&&i.get(e)&&(o=i.get(e)),(o=o||i.get(null,r))?(t.$.extend(o.options,e),o.__promise.then(a.resolve),o.__client++):((o=n.create(e,e.runtimeOrder)).__promise=a.promise(),o.once("ready",a.resolve),o.init(),i.add(o),o.__client=1),r&&(o.__standalone=r),o},this.getRuntime=function(){return o},this.disconnectRuntime=function(){o&&(o.__client--,o.__client<=0&&(i.remove(o),delete o.__promise,o.destroy()),o=null)},this.exec=function(){if(o){var n=t.slice(arguments);return e&&n.unshift(e),o.exec.apply(this,n)}},this.getRuid=function(){return o&&o.uid},this.destroy=(s=this.destroy,function(){s&&s.apply(this,arguments),this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()})}return r={},i={add:function(t){r[t.uid]=t},get:function(t,e){var n;if(t)return r[t];for(n in r)if(!e||!r[n].__standalone)return r[n];return null},remove:function(t){delete r[t.uid]}},e.installTo(o.prototype),o}),s("lib/dnd",["base","mediator","runtime/client"],function(t,e,n){var i=t.$;function r(t){(t=this.options=i.extend({},r.options,t)).container=i(t.container),t.container.length&&n.call(this,"DragAndDrop")}return r.options={accept:null,disableGlobalDnd:!1},t.inherits(n,{constructor:r,init:function(){var t=this;t.connectRuntime(t.options,function(){t.exec("init"),t.trigger("ready")})}}),e.installTo(r.prototype),r}),s("widgets/widget",["base","uploader"],function(t,e){var n=t.$,i=e.prototype._init,r=e.prototype.destroy,o={},s=[];function a(t){this.owner=t,this.options=t.options}return n.extend(a.prototype,{init:t.noop,invoke:function(t,e){var i=this.responseMap;return i&&t in i&&i[t]in this&&n.isFunction(this[i[t]])?this[i[t]].apply(this,e):o},request:function(){return this.owner.request.apply(this.owner,arguments)}}),n.extend(e.prototype,{_init:function(){var t=this,e=t._widgets=[],r=t.options.disableWidgets||"";return n.each(s,function(n,i){(!r||!~r.indexOf(i._name))&&e.push(new i(t))}),i.apply(t,arguments)},request:function(e,i,r){var s,a,u,c=0,l=this._widgets,h=l&&l.length,f=[],p=[];for(i=function(t){if(!t)return!1;var e=t.length,i=n.type(t);return!(1!==t.nodeType||!e)||"array"===i||"function"!==i&&"string"!==i&&(0===e||"number"==typeof e&&0<e&&e-1 in t)}(i)?i:[i];c<h;c++)(s=l[c].invoke(e,i))!==o&&(t.isPromise(s)?p.push(s):f.push(s));return r||p.length?(a=t.when.apply(t,p))[u=a.pipe?"pipe":"then"](function(){var e=t.Deferred(),n=arguments;return 1===n.length&&(n=n[0]),setTimeout(function(){e.resolve(n)},1),e.promise()})[r?u:"done"](r||t.noop):f[0]},destroy:function(){r.apply(this,arguments),this._widgets=null}}),e.register=a.register=function(e,i){var r,o={init:"init",destroy:"destroy",name:"anonymous"};return 1===arguments.length?(i=e,n.each(i,function(t){"_"!==t[0]&&"name"!==t?o[t.replace(/[A-Z]/g,"-$&").toLowerCase()]=t:"name"===t&&(o.name=i.name)})):o=n.extend(o,e),i.responseMap=o,(r=t.inherits(a,i))._name=o.name,s.push(r),r},e.unRegister=a.unRegister=function(t){if(t&&"anonymous"!==t)for(var e=s.length;e--;)s[e]._name===t&&s.splice(e,1)},a}),s("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(t,e,n){var i=t.$;return e.options.dnd="",e.register({name:"dnd",init:function(e){if(e.dnd&&"html5"===this.request("predict-runtime-type")){var r,o=this,s=t.Deferred(),a=i.extend({},{disableGlobalDnd:e.disableGlobalDnd,container:e.dnd,accept:e.accept});return this.dnd=r=new n(a),r.once("ready",s.resolve),r.on("drop",function(t){o.request("add-file",[t])}),r.on("accept",function(t){return o.owner.trigger("dndAccept",t)}),r.init(),s.promise()}},destroy:function(){this.dnd&&this.dnd.destroy()}})}),s("lib/filepaste",["base","mediator","runtime/client"],function(t,e,n){var i=t.$;function r(t){(t=this.options=i.extend({},t)).container=i(t.container||document.body),n.call(this,"FilePaste")}return t.inherits(n,{constructor:r,init:function(){var t=this;t.connectRuntime(t.options,function(){t.exec("init"),t.trigger("ready")})}}),e.installTo(r.prototype),r}),s("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(t,e,n){var i=t.$;return e.register({name:"paste",init:function(e){if(e.paste&&"html5"===this.request("predict-runtime-type")){var r,o=this,s=t.Deferred(),a=i.extend({},{container:e.paste,accept:e.accept});return this.paste=r=new n(a),r.once("ready",s.resolve),r.on("paste",function(t){o.owner.request("add-file",[t])}),r.init(),s.promise()}},destroy:function(){this.paste&&this.paste.destroy()}})}),s("lib/blob",["base","runtime/client"],function(t,e){function n(t,n){this.source=n,this.ruid=t,this.size=n.size||0,!n.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)?this.type="image/"+("jpg"===this.ext?"jpeg":this.ext):this.type=n.type||"application/octet-stream",e.call(this,"Blob"),this.uid=n.uid||this.uid,t&&this.connectRuntime(t)}return t.inherits(e,{constructor:n,slice:function(t,e){return this.exec("slice",t,e)},getSource:function(){return this.source}}),n}),s("lib/file",["base","lib/blob"],function(t,e){var n=1,i=/\.([^.]+)$/;return t.inherits(e,function(t,r){var o;this.name=r.name||"untitled"+n++,!(o=i.exec(r.name)?RegExp.$1.toLowerCase():"")&&r.type&&(o=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(r.type)?RegExp.$1.toLowerCase():"",this.name+="."+o),this.ext=o,this.lastModifiedDate=r.lastModifiedDate||(new Date).toLocaleString(),e.apply(this,arguments)})}),s("lib/filepicker",["base","runtime/client","lib/file"],function(t,e,n){var i=t.$;function r(t){if((t=this.options=i.extend({},r.options,t)).container=i(t.id),!t.container.length)throw new Error("按钮指定错误");t.innerHTML=t.innerHTML||t.label||t.container.html()||"",t.button=i(t.button||document.createElement("div")),t.button.html(t.innerHTML),t.container.html(t.button),e.call(this,"FilePicker",!0)}return r.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file",style:"webuploader-pick"},t.inherits(e,{constructor:r,init:function(){var e=this,r=e.options,s=r.button,a=r.style;a&&s.addClass("webuploader-pick"),e.on("all",function(t){var o;switch(t){case"mouseenter":a&&s.addClass("webuploader-pick-hover");break;case"mouseleave":a&&s.removeClass("webuploader-pick-hover");break;case"change":o=e.exec("getFiles"),e.trigger("select",i.map(o,function(t){return(t=new n(e.getRuid(),t))._refer=r.container,t}),r.container)}}),e.connectRuntime(r,function(){e.refresh(),e.exec("init",r),e.trigger("ready")}),this._resizeHandler=t.bindFn(this.refresh,this),i(o).on("resize",this._resizeHandler)},refresh:function(){var t=this.getRuntime().getContainer(),e=this.options.button,n=e.outerWidth?e.outerWidth():e.width(),i=e.outerHeight?e.outerHeight():e.height(),r=e.offset();n&&i&&t.css({bottom:"auto",right:"auto",width:n+"px",height:i+"px"}).offset(r)},enable:function(){this.options.button.removeClass("webuploader-pick-disable"),this.refresh()},disable:function(){var t=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"}),t.addClass("webuploader-pick-disable")},destroy:function(){var t=this.options.button;i(o).off("resize",this._resizeHandler),t.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")}}),r}),s("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(t,e,n){var i=t.$;return i.extend(e.options,{pick:null,accept:null}),e.register({name:"picker",init:function(t){return this.pickers=[],t.pick&&this.addBtn(t.pick)},refresh:function(){i.each(this.pickers,function(){this.refresh()})},addBtn:function(e){var r=this,o=r.options,s=o.accept,a=[];if(e)return i.isPlainObject(e)||(e={id:e}),i(e.id).each(function(){var u,c,l;l=t.Deferred(),u=i.extend({},e,{accept:i.isPlainObject(s)?[s]:s,swf:o.swf,runtimeOrder:o.runtimeOrder,id:this}),(c=new n(u)).once("ready",l.resolve),c.on("select",function(t){r.owner.request("add-file",[t])}),c.on("dialogopen",function(){r.owner.trigger("dialogOpen",c.button)}),c.init(),r.pickers.push(c),a.push(l.promise())}),t.when.apply(t,a)},disable:function(){i.each(this.pickers,function(){this.disable()})},enable:function(){i.each(this.pickers,function(){this.enable()})},destroy:function(){i.each(this.pickers,function(){this.destroy()}),this.pickers=null}})}),s("lib/image",["base","runtime/client","lib/blob"],function(t,e,n){var i=t.$;function r(t){this.options=i.extend({},r.options,t),e.call(this,"Image"),this.on("load",function(){this._info=this.exec("info"),this._meta=this.exec("meta")})}return r.options={quality:90,crop:!1,preserveHeaders:!1,allowMagnify:!1},t.inherits(e,{constructor:r,info:function(t){return t?(this._info=t,this):this._info},meta:function(t){return t?(this._meta=t,this):this._meta},loadFromBlob:function(t){var e=this,n=t.getRuid();this.connectRuntime(n,function(){e.exec("init",e.options),e.exec("loadFromBlob",t)})},resize:function(){var e=t.slice(arguments);return this.exec.apply(this,["resize"].concat(e))},crop:function(){var e=t.slice(arguments);return this.exec.apply(this,["crop"].concat(e))},getAsDataUrl:function(t){return this.exec("getAsDataUrl",t)},getAsBlob:function(t){var e=this.exec("getAsBlob",t);return new n(this.getRuid(),e)}}),r}),s("widgets/image",["base","uploader","lib/image","widgets/widget"],function(t,e,n){var i,r,o,s,a=t.$;return r=0,o=[],s=function(){for(var t;o.length&&r<5242880;)t=o.shift(),r+=t[0],t[1]()},i=function(t,e,n){o.push([e,n]),t.once("destroy",function(){r-=e,setTimeout(s,1)}),setTimeout(s,1)},a.extend(e.options,{thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}}),e.register({name:"image",makeThumb:function(t,e,r,o){var s,u;(t=this.request("get-file",t)).type.match(/^image/)?(s=a.extend({},this.options.thumb),a.isPlainObject(r)&&(s=a.extend(s,r),r=null),r=r||s.width,o=o||s.height,(u=new n(s)).once("load",function(){t._info=t._info||u.info(),t._meta=t._meta||u.meta(),r<=1&&0<r&&(r=t._info.width*r),o<=1&&0<o&&(o=t._info.height*o),u.resize(r,o)}),u.once("complete",function(){e(!1,u.getAsDataUrl(s.type)),u.destroy()}),u.once("error",function(t){e(t||!0),u.destroy()}),i(u,t.source.size,function(){t._info&&u.info(t._info),t._meta&&u.meta(t._meta),u.loadFromBlob(t.source)})):e(!0)},beforeSendFile:function(e){var i,r,o=this.options.compress||this.options.resize,s=o&&o.compressSize||0,u=o&&o.noCompressIfLarger||!1;if(e=this.request("get-file",e),o&&~"image/jpeg,image/jpg".indexOf(e.type)&&!(e.size<s)&&!e._compressed)return o=a.extend({},o),r=t.Deferred(),i=new n(o),r.always(function(){i.destroy(),i=null}),i.once("error",r.reject),i.once("load",function(){var t=o.width,n=o.height;e._info=e._info||i.info(),e._meta=e._meta||i.meta(),t<=1&&0<t&&(t=e._info.width*t),n<=1&&0<n&&(n=e._info.height*n),i.resize(t,n)}),i.once("complete",function(){var t,n;try{t=i.getAsBlob(o.type),n=e.size,(!u||t.size<n)&&(e.source=t,e.size=t.size,e.trigger("resize",t.size,n)),e._compressed=!0,r.resolve()}catch(t){r.resolve()}}),e._info&&i.info(e._info),e._meta&&i.meta(e._meta),i.loadFromBlob(e.source),r.promise()}})}),s("file",["base","mediator"],function(t,e){var n="WU_FILE_",i=0,r=/\.([^.]+)$/,o={};function s(t){this.name=t.name||"Untitled",this.size=t.size||0,this.type=t.type||"application/octet-stream",this.lastModifiedDate=t.lastModifiedDate||1*new Date,this.id=n+i++,this.ext=r.exec(this.name)?RegExp.$1:"",this.statusText="",o[this.id]=s.Status.INITED,this.source=t,this.loaded=0,this.on("error",function(t){this.setStatus(s.Status.ERROR,t)})}return t.$.extend(s.prototype,{setStatus:function(t,e){var n=o[this.id];void 0!==e&&(this.statusText=e),t!==n&&(o[this.id]=t,this.trigger("statuschange",t,n))},getStatus:function(){return o[this.id]},getSource:function(){return this.source},destroy:function(){this.off(),delete o[this.id]}}),e.installTo(s.prototype),s.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"},s}),s("queue",["base","mediator","file"],function(t,e,n){var i=t.$,r=n.Status;function o(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0},this._queue=[],this._map={}}return i.extend(o.prototype,{append:function(t){return this._queue.push(t),this._fileAdded(t),this},prepend:function(t){return this._queue.unshift(t),this._fileAdded(t),this},getFile:function(t){return"string"!=typeof t?t:this._map[t]},fetch:function(t){var e,n,i=this._queue.length;for(t=t||r.QUEUED,e=0;e<i;e++)if(t===(n=this._queue[e]).getStatus())return n;return null},sort:function(t){"function"==typeof t&&this._queue.sort(t)},getFiles:function(){for(var t,e=[].slice.call(arguments,0),n=[],r=0,o=this._queue.length;r<o;r++)t=this._queue[r],e.length&&!~i.inArray(t.getStatus(),e)||n.push(t);return n},removeFile:function(t){this._map[t.id]&&(delete this._map[t.id],t.destroy(),this.stats.numofDeleted++)},_fileAdded:function(t){var e=this;this._map[t.id]||(this._map[t.id]=t).on("statuschange",function(t,n){e._onFileStatusChange(t,n)})},_onFileStatusChange:function(t,e){var n=this.stats;switch(e){case r.PROGRESS:n.numOfProgress--;break;case r.QUEUED:n.numOfQueue--;break;case r.ERROR:n.numOfUploadFailed--;break;case r.INVALID:n.numOfInvalid--;break;case r.INTERRUPT:n.numofInterrupt--}switch(t){case r.QUEUED:n.numOfQueue++;break;case r.PROGRESS:n.numOfProgress++;break;case r.ERROR:n.numOfUploadFailed++;break;case r.COMPLETE:n.numOfSuccess++;break;case r.CANCELLED:n.numOfCancel++;break;case r.INVALID:n.numOfInvalid++;break;case r.INTERRUPT:n.numofInterrupt++}}}),e.installTo(o.prototype),o}),s("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(t,e,n,i,r,o){var s=t.$,a=/\.\w+$/,u=i.Status;return e.register({name:"queue",init:function(e){var i,r,a,u,c,l,h,f=this;if(s.isPlainObject(e.accept)&&(e.accept=[e.accept]),e.accept){for(c=[],a=0,r=e.accept.length;a<r;a++)(u=e.accept[a].extensions)&&c.push(u);c.length&&(l="\\."+c.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"),f.accept=new RegExp(l,"i")}if(f.queue=new n,f.stats=f.queue.stats,"html5"===this.request("predict-runtime-type"))return i=t.Deferred(),this.placeholder=h=new o("Placeholder"),h.connectRuntime({runtimeOrder:"html5"},function(){f._ruid=h.getRuid(),i.resolve()}),i.promise()},_wrapFile:function(t){if(!(t instanceof i)){if(!(t instanceof r)){if(!this._ruid)throw new Error("Can't add external files.");t=new r(this._ruid,t)}t=new i(t)}return t},acceptFile:function(t){return!(!t||!t.size||this.accept&&a.exec(t.name)&&!this.accept.test(t.name))},_addFile:function(t){var e=this;if(t=e._wrapFile(t),e.owner.trigger("beforeFileQueued",t)){if(e.acceptFile(t))return e.queue.append(t),e.owner.trigger("fileQueued",t),t;e.owner.trigger("error","Q_TYPE_DENIED",t)}},getFile:function(t){return this.queue.getFile(t)},addFile:function(t){var e=this;t.length||(t=[t]),(t=s.map(t,function(t){return e._addFile(t)})).length&&(e.owner.trigger("filesQueued",t),e.options.auto&&setTimeout(function(){e.request("start-upload")},20))},getStats:function(){return this.stats},removeFile:function(t,e){t=t.id?t:this.queue.getFile(t),this.request("cancel-file",t),e&&this.queue.removeFile(t)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(t,e){var n,i,r;if(t)return(t=t.id?t:this.queue.getFile(t)).setStatus(u.QUEUED),void(e||this.request("start-upload"));for(i=0,r=(n=this.queue.getFiles(u.ERROR)).length;i<r;i++)(t=n[i]).setStatus(u.QUEUED);this.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset"),this.queue=new n,this.stats=this.queue.stats},destroy:function(){this.reset(),this.placeholder&&this.placeholder.destroy()}})}),s("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(t,e){return t.support=function(){return e.hasRuntime.apply(e,arguments)},t.register({name:"runtime",init:function(){if(!this.predictRuntimeType())throw Error("Runtime Error")},predictRuntimeType:function(){var t,n,i=this.options.runtimeOrder||e.orders,r=this.type;if(!r)for(t=0,n=(i=i.split(/\s*,\s*/g)).length;t<n;t++)if(e.hasRuntime(i[t])){this.type=r=i[t];break}return r}})}),s("lib/transport",["base","runtime/client","mediator"],function(t,e,n){var i=t.$;function r(t){var n=this;t=n.options=i.extend(!0,{},r.options,t||{}),e.call(this,"Transport"),this._blob=null,this._formData=t.formData||{},this._headers=t.headers||{},this.on("progress",this._timeout),this.on("load error",function(){n.trigger("progress",1),clearTimeout(n._timer)})}return r.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:12e4,formData:{},headers:{},sendAsBinary:!1},i.extend(r.prototype,{appendBlob:function(t,e,n){var i=this,r=i.options;i.getRuid()&&i.disconnectRuntime(),i.connectRuntime(e.ruid,function(){i.exec("init")}),i._blob=e,r.fileVal=t||r.fileVal,r.filename=n||r.filename},append:function(t,e){"object"==typeof t?i.extend(this._formData,t):this._formData[t]=e},setRequestHeader:function(t,e){"object"==typeof t?i.extend(this._headers,t):this._headers[t]=e},send:function(t){this.exec("send",t),this._timeout()},abort:function(){return clearTimeout(this._timer),this.exec("abort")},destroy:function(){this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var t=this,e=t.options.timeout;e&&(clearTimeout(t._timer),t._timer=setTimeout(function(){t.abort(),t.trigger("error","timeout")},e))}}),n.installTo(r.prototype),r}),s("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(t,e,n,i){var r=t.$,o=t.isPromise,s=n.Status;r.extend(e.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:{}}),e.register({name:"upload",init:function(){var e=this.owner,n=this;this.runing=!1,this.progress=!1,e.on("startUpload",function(){n.progress=!0}).on("uploadFinished",function(){n.progress=!1}),this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this.__tick=t.bindFn(this._tick,this),e.on("uploadComplete",function(t){t.blocks&&r.each(t.blocks,function(t,e){e.transport&&(e.transport.abort(),e.transport.destroy()),delete e.transport}),delete t.blocks,delete t.remaning})},reset:function(){this.request("stop-upload",!0),this.runing=!1,this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this._trigged=!1,this._promise=null},startUpload:function(e){var n=this;if(r.each(n.request("get-files",s.INVALID),function(){n.request("remove-file",this)}),e?(e=e.id?e:n.request("get-file",e)).getStatus()===s.INTERRUPT?(e.setStatus(s.QUEUED),r.each(n.pool,function(t,n){n.file===e&&(n.transport&&n.transport.send(),e.setStatus(s.PROGRESS))})):e.getStatus()!==s.PROGRESS&&e.setStatus(s.QUEUED):r.each(n.request("get-files",[s.INITED]),function(){this.setStatus(s.QUEUED)}),n.runing)return t.nextTick(n.__tick);n.runing=!0;var i=[];e||r.each(n.pool,function(t,e){var r=e.file;r.getStatus()===s.INTERRUPT&&(n._trigged=!1,i.push(r),e.transport&&e.transport.send())}),r.each(i,function(){this.setStatus(s.PROGRESS)}),e||r.each(n.request("get-files",s.INTERRUPT),function(){this.setStatus(s.PROGRESS)}),n._trigged=!1,t.nextTick(n.__tick),n.owner.trigger("startUpload")},stopUpload:function(e,n){var i,o=this;if(!0===e&&(n=e,e=null),!1!==o.runing){if(e){if((e=e.id?e:o.request("get-file",e)).getStatus()!==s.PROGRESS&&e.getStatus()!==s.QUEUED)return;return e.setStatus(s.INTERRUPT),r.each(o.pool,function(t,n){if(n.file===e)return i=n,!1}),i.transport&&i.transport.abort(),n&&(o._putback(i),o._popBlock(i)),t.nextTick(o.__tick)}o.runing=!1,this._promise&&this._promise.file&&this._promise.file.setStatus(s.INTERRUPT),n&&r.each(o.pool,function(t,e){e.transport&&e.transport.abort(),e.file.setStatus(s.INTERRUPT)}),o.owner.trigger("stopUpload")}},cancelFile:function(t){(t=t.id?t:this.request("get-file",t)).blocks&&r.each(t.blocks,function(t,e){var n=e.transport;n&&(n.abort(),n.destroy(),delete e.transport)}),t.setStatus(s.CANCELLED),this.owner.trigger("fileDequeued",t)},isInProgress:function(){return!!this.progress},_getStats:function(){return this.request("get-stats")},skipFile:function(t,e){(t=t.id?t:this.request("get-file",t)).setStatus(e||s.COMPLETE),t.skipped=!0,t.blocks&&r.each(t.blocks,function(t,e){var n=e.transport;n&&(n.abort(),n.destroy(),delete e.transport)}),this.owner.trigger("uploadSkip",t)},_tick:function(){var e,n,i=this,r=i.options;if(i._promise)return i._promise.always(i.__tick);i.pool.length<r.threads&&(n=i._nextBlock())?(i._trigged=!1,e=function(e){i._promise=null,e&&e.file&&i._startSend(e),t.nextTick(i.__tick)},i._promise=o(n)?n.always(e):e(n)):i.remaning||i._getStats().numOfQueue||i._getStats().numofInterrupt||(i.runing=!1,i._trigged||t.nextTick(function(){i.owner.trigger("uploadFinished")}),i._trigged=!0)},_putback:function(t){t.cuted.unshift(t),~this.stack.indexOf(t.cuted)||this.stack.unshift(t.cuted)},_getStack:function(){for(var t,e=0;t=this.stack[e++];){if(t.has()&&t.file.getStatus()===s.PROGRESS)return t;(!t.has()||t.file.getStatus()!==s.PROGRESS&&t.file.getStatus()!==s.INTERRUPT)&&this.stack.splice(--e,1)}return null},_nextBlock:function(){var t,e,n,i,r=this,s=r.options;return(t=this._getStack())?(s.prepareNextFile&&!r.pending.length&&r._prepareNextFile(),t.shift()):r.runing?(!r.pending.length&&r._getStats().numOfQueue&&r._prepareNextFile(),e=r.pending.shift(),n=function(e){return e?(t=function(t,e){var n,i,r=[],o=t.source.size,s=e?Math.ceil(o/e):1,a=0,u=0;for(i={file:t,has:function(){return!!r.length},shift:function(){return r.shift()},unshift:function(t){r.unshift(t)}};u<s;)n=Math.min(e,o-a),r.push({file:t,start:a,end:e?a+n:o,total:o,chunks:s,chunk:u++,cuted:i}),a+=n;return t.blocks=r.concat(),t.remaning=r.length,i}(e,s.chunked?s.chunkSize:0),r.stack.push(t),t.shift()):null},o(e)?(i=e.file,(e=e[e.pipe?"pipe":"then"](n)).file=i,e):n(e)):void 0},_prepareNextFile:function(){var t,e=this,n=e.request("fetch-file"),i=e.pending;n&&(t=e.request("before-send-file",n,function(){return n.getStatus()===s.PROGRESS||n.getStatus()===s.INTERRUPT?n:e._finishFile(n)}),e.owner.trigger("uploadStart",n),n.setStatus(s.PROGRESS),t.file=n,t.done(function(){var e=r.inArray(t,i);~e&&i.splice(e,1,n)}),t.fail(function(t){n.setStatus(s.ERROR,t),e.owner.trigger("uploadError",n,t),e.owner.trigger("uploadComplete",n)}),i.push(t))},_popBlock:function(t){var e=r.inArray(t,this.pool);this.pool.splice(e,1),t.file.remaning--,this.remaning--},_startSend:function(e){var n=this,i=e.file;i.getStatus()===s.PROGRESS?(n.pool.push(e),n.remaning++,e.blob=1===e.chunks?i.source:i.source.slice(e.start,e.end),n.request("before-send",e,function(){i.getStatus()===s.PROGRESS?n._doSend(e):(n._popBlock(e),t.nextTick(n.__tick))}).fail(function(){1===i.remaning?n._finishFile(i).always(function(){e.percentage=1,n._popBlock(e),n.owner.trigger("uploadComplete",i),t.nextTick(n.__tick)}):(e.percentage=1,n.updateFileProgress(i),n._popBlock(e),t.nextTick(n.__tick))})):i.getStatus()===s.INTERRUPT&&n._putback(e)},_doSend:function(e){var n,o,a=this,u=a.owner,c=a.options,l=e.file,h=new i(c),f=r.extend({},c.formData),p=r.extend({},c.headers);(e.transport=h).on("destroy",function(){delete e.transport,a._popBlock(e),t.nextTick(a.__tick)}),h.on("progress",function(t){e.percentage=t,a.updateFileProgress(l)}),n=function(t){var n;return(o=h.getResponseAsJson()||{})._raw=h.getResponse(),n=function(e){t=e},u.trigger("uploadAccept",e,o,n)||(t=t||"server"),t},h.on("error",function(t,i){e.retried=e.retried||0,1<e.chunks&&~"http,abort".indexOf(t)&&e.retried<c.chunkRetry?(e.retried++,h.send()):(i||"server"!==t||(t=n(t)),l.setStatus(s.ERROR,t),u.trigger("uploadError",l,t),u.trigger("uploadComplete",l))}),h.on("load",function(){var t;(t=n())?h.trigger("error",t,!0):1===l.remaning?a._finishFile(l,o):h.destroy()}),f=r.extend(f,{id:l.id,name:l.name,type:l.type,lastModifiedDate:l.lastModifiedDate,size:l.size}),1<e.chunks&&r.extend(f,{chunks:e.chunks,chunk:e.chunk}),u.trigger("uploadBeforeSend",e,f,p),h.appendBlob(c.fileVal,e.blob,l.name),h.append(f),h.setRequestHeader(p),h.send()},_finishFile:function(t,e,n){var i=this.owner;return i.request("after-send-file",arguments,function(){t.setStatus(s.COMPLETE),i.trigger("uploadSuccess",t,e,n)}).fail(function(e){t.getStatus()===s.PROGRESS&&t.setStatus(s.ERROR,e),i.trigger("uploadError",t,e)}).always(function(){i.trigger("uploadComplete",t)})},updateFileProgress:function(t){var e,n=0;t.blocks&&(r.each(t.blocks,function(t,e){n+=(e.percentage||0)*(e.end-e.start)}),e=n/t.size,this.owner.trigger("uploadProgress",t,e||0))}})}),s("widgets/validator",["base","uploader","file","widgets/widget"],function(t,e,n){var i,r=t.$,o={};return i={addValidator:function(t,e){o[t]=e},removeValidator:function(t){delete o[t]}},e.register({name:"validator",init:function(){var e=this;t.nextTick(function(){r.each(o,function(){this.call(e.owner)})})}}),i.addValidator("fileNumLimit",function(){var t=this,e=t.options,n=0,i=parseInt(e.fileNumLimit,10),r=!0;i&&(t.on("beforeFileQueued",function(t){return i<=n&&r&&(r=!1,this.trigger("error","Q_EXCEED_NUM_LIMIT",i,t),setTimeout(function(){r=!0},1)),!(i<=n)}),t.on("fileQueued",function(){n++}),t.on("fileDequeued",function(){n--}),t.on("reset",function(){n=0}))}),i.addValidator("fileSizeLimit",function(){var t=this,e=t.options,n=0,i=parseInt(e.fileSizeLimit,10),r=!0;i&&(t.on("beforeFileQueued",function(t){var e=n+t.size>i;return e&&r&&(r=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",i,t),setTimeout(function(){r=!0},1)),!e}),t.on("fileQueued",function(t){n+=t.size}),t.on("fileDequeued",function(t){n-=t.size}),t.on("reset",function(){n=0}))}),i.addValidator("fileSingleSizeLimit",function(){var t=this.options.fileSingleSizeLimit;t&&this.on("beforeFileQueued",function(e){if(e.size>t)return e.setStatus(n.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",t,e),!1})}),i.addValidator("duplicate",function(){var t=this,e={};t.options.duplicate||(t.on("beforeFileQueued",function(t){var n=t.__hash||(t.__hash=function(t){for(var e=0,n=0,i=t.length;n<i;n++)e=t.charCodeAt(n)+(e<<6)+(e<<16)-e;return e}(t.name+t.size+t.lastModifiedDate));if(e[n])return this.trigger("error","F_DUPLICATE",t),!1}),t.on("fileQueued",function(t){var n=t.__hash;n&&(e[n]=!0)}),t.on("fileDequeued",function(t){var n=t.__hash;n&&delete e[n]}),t.on("reset",function(){e={}}))}),i}),s("lib/md5",["runtime/client","mediator"],function(t,e){function n(){t.call(this,"Md5")}return e.installTo(n.prototype),n.prototype.loadFromBlob=function(t){var e=this;e.getRuid()&&e.disconnectRuntime(),e.connectRuntime(t.ruid,function(){e.exec("init"),e.exec("loadFromBlob",t)})},n.prototype.getResult=function(){return this.exec("getResult")},n}),s("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(t,e,n,i){return e.register({name:"md5",md5File:function(e,r,o){var s=new n,a=t.Deferred(),u=e instanceof i?e:this.request("get-file",e).source;return s.on("progress load",function(t){t=t||{},a.notify(t.total?t.loaded/t.total:1)}),s.on("complete",function(){a.resolve(s.getResult())}),s.on("error",function(t){a.reject(t)}),1<arguments.length&&(o=o||0,(r=r||0)<0&&(r=u.size+r),o<0&&(o=u.size+o),o=Math.min(o,u.size),u=u.slice(r,o)),s.loadFromBlob(u),a.promise()}})}),s("runtime/compbase",[],function(){return function(t,e){this.owner=t,this.options=t.options,this.getRuntime=function(){return e},this.getRuid=function(){return e.uid},this.trigger=function(){return t.trigger.apply(t,arguments)}}}),s("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(t,e,n){var i={};function r(){var n={},r=this,o=this.destroy;e.apply(r,arguments),r.type="html5",r.exec=function(e,o){var s,a=this.uid,u=t.slice(arguments,2);if(i[e]&&(s=n[a]=n[a]||new i[e](this,r))[o])return s[o].apply(s,u)},r.destroy=function(){return o&&o.apply(this,arguments)}}return t.inherits(e,{constructor:r,init:function(){var t=this;setTimeout(function(){t.trigger("ready")},1)}}),r.register=function(e,r){return i[e]=t.inherits(n,r)},o.Blob&&o.FileReader&&o.DataView&&e.addRuntime("html5",r),r}),s("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(t,e){return t.register("Blob",{slice:function(t,n){var i=this.owner.source;return i=(i.slice||i.webkitSlice||i.mozSlice).call(i,t,n),new e(this.getRuid(),i)}})}),s("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(t,e,n){var i=t.$,r="webuploader-dnd-";return e.register("DragAndDrop",{init:function(){var e=this.elem=this.options.container;this.dragEnterHandler=t.bindFn(this._dragEnterHandler,this),this.dragOverHandler=t.bindFn(this._dragOverHandler,this),this.dragLeaveHandler=t.bindFn(this._dragLeaveHandler,this),this.dropHandler=t.bindFn(this._dropHandler,this),this.dndOver=!1,e.on("dragenter",this.dragEnterHandler),e.on("dragover",this.dragOverHandler),e.on("dragleave",this.dragLeaveHandler),e.on("drop",this.dropHandler),this.options.disableGlobalDnd&&(i(document).on("dragover",this.dragOverHandler),i(document).on("drop",this.dropHandler))},_dragEnterHandler:function(t){var e,n=this,i=n._denied||!1;return t=t.originalEvent||t,n.dndOver||(n.dndOver=!0,(e=t.dataTransfer.items)&&e.length&&(n._denied=i=!n.trigger("accept",e)),n.elem.addClass(r+"over"),n.elem[i?"addClass":"removeClass"](r+"denied")),t.dataTransfer.dropEffect=i?"none":"copy",!1},_dragOverHandler:function(t){var e=this.elem.parent().get(0);return e&&!i.contains(e,t.currentTarget)||(clearTimeout(this._leaveTimer),this._dragEnterHandler.call(this,t)),!1},_dragLeaveHandler:function(){var t,e=this;return t=function(){e.dndOver=!1,e.elem.removeClass(r+"over "+r+"denied")},clearTimeout(e._leaveTimer),e._leaveTimer=setTimeout(t,100),!1},_dropHandler:function(t){var e,o,s=this,a=s.getRuid(),u=s.elem.parent().get(0);if(u&&!i.contains(u,t.currentTarget))return!1;e=(t=t.originalEvent||t).dataTransfer;try{o=e.getData("text/html")}catch(t){}return s.dndOver=!1,s.elem.removeClass(r+"over"),o?void 0:(s._getTansferFiles(e,function(t){s.trigger("drop",i.map(t,function(t){return new n(a,t)}))}),!1)},_getTansferFiles:function(e,n){var i,r,o,s,a,u,c,l=[],h=[];for(i=e.items,r=e.files,c=!(!i||!i[0].webkitGetAsEntry),a=0,u=r.length;a<u;a++)o=r[a],s=i&&i[a],c&&s.webkitGetAsEntry().isDirectory?h.push(this._traverseDirectoryTree(s.webkitGetAsEntry(),l)):l.push(o);t.when.apply(t,h).done(function(){l.length&&n(l)})},_traverseDirectoryTree:function(e,n){var i=t.Deferred(),r=this;return e.isFile?e.file(function(t){n.push(t),i.resolve()}):e.isDirectory&&e.createReader().readEntries(function(e){var o,s=e.length,a=[],u=[];for(o=0;o<s;o++)a.push(r._traverseDirectoryTree(e[o],u));t.when.apply(t,a).then(function(){n.push.apply(n,u),i.resolve()},i.reject)}),i.promise()},destroy:function(){var t=this.elem;t&&(t.off("dragenter",this.dragEnterHandler),t.off("dragover",this.dragOverHandler),t.off("dragleave",this.dragLeaveHandler),t.off("drop",this.dropHandler),this.options.disableGlobalDnd&&(i(document).off("dragover",this.dragOverHandler),i(document).off("drop",this.dropHandler)))}})}),s("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(t,e,n){return e.register("FilePaste",{init:function(){var e,n,i,r,o=this.options,s=this.elem=o.container,a=".*";if(o.accept){for(e=[],n=0,i=o.accept.length;n<i;n++)(r=o.accept[n].mimeTypes)&&e.push(r);e.length&&(a=(a=e.join(",")).replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=a=new RegExp(a,"i"),this.hander=t.bindFn(this._pasteHander,this),s.on("paste",this.hander)},_pasteHander:function(t){var e,i,r,o,s,a=[],u=this.getRuid();for(o=0,s=(e=(t=t.originalEvent||t).clipboardData.items).length;o<s;o++)"file"===(i=e[o]).kind&&(r=i.getAsFile())&&a.push(new n(u,r));a.length&&(t.preventDefault(),t.stopPropagation(),this.trigger("paste",a))},destroy:function(){this.elem.off("paste",this.hander)}})}),s("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(t,e){var n=t.$;return e.register("FilePicker",{init:function(){var t,e,i,r,o=this.getRuntime().getContainer(),s=this,a=s.owner,u=s.options,c=this.label=n(document.createElement("label")),l=this.input=n(document.createElement("input"));if(l.attr("type","file"),l.attr("capture","camera"),l.attr("name",u.name),l.addClass("webuploader-element-invisible"),c.on("click",function(t){l.trigger("click"),t.stopPropagation(),a.trigger("dialogopen")}),c.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"}),u.multiple&&l.attr("multiple","multiple"),u.accept&&0<u.accept.length){for(t=[],e=0,i=u.accept.length;e<i;e++)t.push(u.accept[e].mimeTypes);l.attr("accept",t.join(","))}o.append(l),o.append(c),r=function(t){a.trigger(t.type)},l.on("change",function(t){var e,i=arguments.callee;s.files=t.target.files,(e=this.cloneNode(!0)).value=null,this.parentNode.replaceChild(e,this),l.off(),l=n(e).on("change",i).on("mouseenter mouseleave",r),a.trigger("change")}),c.on("mouseenter mouseleave",r)},getFiles:function(){return this.files},destroy:function(){this.input.off(),this.label.off()}})}),s("runtime/html5/util",["base"],function(t){var e=o.createObjectURL&&o||o.URL&&URL.revokeObjectURL&&URL||o.webkitURL,n=t.noop,i=n;return e&&(n=function(){return e.createObjectURL.apply(e,arguments)},i=function(){return e.revokeObjectURL.apply(e,arguments)}),{createObjectURL:n,revokeObjectURL:i,dataURL2Blob:function(t){var e,n,i,r,o,s;for(e=~(s=t.split(","))[0].indexOf("base64")?atob(s[1]):decodeURIComponent(s[1]),i=new ArrayBuffer(e.length),n=new Uint8Array(i),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return o=s[0].split(":")[1].split(";")[0],this.arrayBufferToBlob(i,o)},dataURL2ArrayBuffer:function(t){var e,n,i,r;for(e=~(r=t.split(","))[0].indexOf("base64")?atob(r[1]):decodeURIComponent(r[1]),n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n.buffer},arrayBufferToBlob:function(t,e){var n,i=o.BlobBuilder||o.WebKitBlobBuilder;return i?((n=new i).append(t),n.getBlob(e)):new Blob([t],e?{type:e}:{})},canvasToDataUrl:function(t,e,n){return t.toDataURL(e,n/100)},parseMeta:function(t,e){e(!1,{})},updateImageHead:function(t){return t}}}),s("runtime/html5/imagemeta",["runtime/html5/util"],function(t){var e;return e={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(t,e){var n=this,i=new FileReader;i.onload=function(){e(!1,n._parse(this.result)),i=i.onload=i.onerror=null},i.onerror=function(t){e(t.message),i=i.onload=i.onerror=null},t=t.slice(0,n.maxMetaDataSize),i.readAsArrayBuffer(t.getSource())},_parse:function(t,n){if(!(t.byteLength<6)){var i,r,o,s,a=new DataView(t),u=2,c=a.byteLength-4,l=u,h={};if(65496===a.getUint16(0)){for(;u<c&&(65504<=(i=a.getUint16(u))&&i<=65519||65534===i)&&!(u+(r=a.getUint16(u+2)+2)>a.byteLength);){if(o=e.parsers[i],!n&&o)for(s=0;s<o.length;s+=1)o[s].call(e,a,u,r,h);l=u+=r}6<l&&(t.slice?h.imageHead=t.slice(2,l):h.imageHead=new Uint8Array(t).subarray(2,l))}return h}},updateImageHead:function(t,e){var n,i,r,o=this._parse(t,!0);return r=2,o.imageHead&&(r=2+o.imageHead.byteLength),i=t.slice?t.slice(r):new Uint8Array(t).subarray(r),(n=new Uint8Array(e.byteLength+2+i.byteLength))[0]=255,n[1]=216,n.set(new Uint8Array(e),2),n.set(new Uint8Array(i),e.byteLength+2),n.buffer}},t.parseMeta=function(){return e.parse.apply(e,arguments)},t.updateImageHead=function(){return e.updateImageHead.apply(e,arguments)},e}),s("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(t,e){var n={ExifMap:function(){return this}};return n.ExifMap.prototype.map={Orientation:274},n.ExifMap.prototype.get=function(t){return this[t]||this[this.map[t]]},n.exifTagTypes={1:{getValue:function(t,e){return t.getUint8(e)},size:1},2:{getValue:function(t,e){return String.fromCharCode(t.getUint8(e))},size:1,ascii:!0},3:{getValue:function(t,e,n){return t.getUint16(e,n)},size:2},4:{getValue:function(t,e,n){return t.getUint32(e,n)},size:4},5:{getValue:function(t,e,n){return t.getUint32(e,n)/t.getUint32(e+4,n)},size:8},9:{getValue:function(t,e,n){return t.getInt32(e,n)},size:4},10:{getValue:function(t,e,n){return t.getInt32(e,n)/t.getInt32(e+4,n)},size:8}},n.exifTagTypes[7]=n.exifTagTypes[1],n.getExifValue=function(e,i,r,o,s,a){var u,c,l,h,f,p,d=n.exifTagTypes[o];if(d){if(!((c=4<(u=d.size*s)?i+e.getUint32(r+8,a):r+8)+u>e.byteLength)){if(1===s)return d.getValue(e,c,a);for(l=[],h=0;h<s;h+=1)l[h]=d.getValue(e,c+h*d.size,a);if(d.ascii){for(f="",h=0;h<l.length&&"\0"!==(p=l[h]);h+=1)f+=p;return f}return l}t.log("Invalid Exif data: Invalid data offset.")}else t.log("Invalid Exif data: Invalid tag type.")},n.parseExifTag=function(t,e,i,r,o){var s=t.getUint16(i,r);o.exif[s]=n.getExifValue(t,e,i,t.getUint16(i+2,r),t.getUint32(i+4,r),r)},n.parseExifTags=function(e,n,i,r,o){var s,a,u;if(i+6>e.byteLength)t.log("Invalid Exif data: Invalid directory offset.");else{if(!((a=i+2+12*(s=e.getUint16(i,r)))+4>e.byteLength)){for(u=0;u<s;u+=1)this.parseExifTag(e,n,i+2+12*u,r,o);return e.getUint32(a,r)}t.log("Invalid Exif data: Invalid directory size.")}},n.parseExifData=function(e,i,r,o){var s,a,u=i+10;if(1165519206===e.getUint32(i+4))if(u+8>e.byteLength)t.log("Invalid Exif data: Invalid segment size.");else if(0===e.getUint16(i+8)){switch(e.getUint16(u)){case 18761:s=!0;break;case 19789:s=!1;break;default:return void t.log("Invalid Exif data: Invalid byte alignment marker.")}42===e.getUint16(u+2,s)?(a=e.getUint32(u+4,s),o.exif=new n.ExifMap,a=n.parseExifTags(e,u,u+a,s,o)):t.log("Invalid Exif data: Missing TIFF marker.")}else t.log("Invalid Exif data: Missing byte alignment offset.")},e.parsers[65505].push(n.parseExifData),n}),s("runtime/html5/jpegencoder",[],function(t,e,n){function i(t){Math.round;var e,n,i,r,o,s=Math.floor,a=new Array(64),u=new Array(64),c=new Array(64),l=new Array(64),h=new Array(65535),f=new Array(65535),p=new Array(64),d=new Array(64),g=[],m=0,v=7,y=new Array(64),w=new Array(64),b=new Array(64),x=new Array(256),_=new Array(2048),S=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],C=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],E=[0,1,2,3,4,5,6,7,8,9,10,11],R=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],k=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],T=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],D=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],O=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function A(t,e){for(var n=0,i=0,r=new Array,o=1;o<=16;o++){for(var s=1;s<=t[o];s++)r[e[i]]=[],r[e[i]][0]=n,r[e[i]][1]=o,i++,n++;n*=2}return r}function I(t){for(var e=t[0],n=t[1]-1;0<=n;)e&1<<n&&(m|=1<<v),n--,--v<0&&(255==m?(j(255),j(0)):j(m),v=7,m=0)}function j(t){g.push(x[t])}function M(t){j(t>>8&255),j(255&t)}function U(t,e,n,i,r){for(var o,s=r[0],a=r[240],u=function(t,e){var n,i,r,o,s,a,u,c,l,h,f=0;for(l=0;l<8;++l){n=t[f],i=t[f+1],r=t[f+2],o=t[f+3],s=t[f+4],a=t[f+5],u=t[f+6];var d=n+(c=t[f+7]),g=n-c,m=i+u,v=i-u,y=r+a,w=r-a,b=o+s,x=o-s,_=d+b,S=d-b,C=m+y,E=m-y;t[f]=_+C,t[f+4]=_-C;var R=.707106781*(E+S);t[f+2]=S+R,t[f+6]=S-R;var k=.382683433*((_=x+w)-(E=v+g)),T=.5411961*_+k,F=1.306562965*E+k,D=.707106781*(C=w+v),O=g+D,A=g-D;t[f+5]=A+T,t[f+3]=A-T,t[f+1]=O+F,t[f+7]=O-F,f+=8}for(l=f=0;l<8;++l){n=t[f],i=t[f+8],r=t[f+16],o=t[f+24],s=t[f+32],a=t[f+40],u=t[f+48];var I=n+(c=t[f+56]),j=n-c,M=i+u,U=i-u,P=r+a,z=r-a,q=o+s,L=o-s,B=I+q,H=I-q,$=M+P,N=M-P;t[f]=B+$,t[f+32]=B-$;var J=.707106781*(N+H);t[f+16]=H+J,t[f+48]=H-J;var Q=.382683433*((B=L+z)-(N=U+j)),G=.5411961*B+Q,V=1.306562965*N+Q,W=.707106781*($=z+U),X=j+W,K=j-W;t[f+40]=K+G,t[f+24]=K-G,t[f+8]=X+V,t[f+56]=X-V,f++}for(l=0;l<64;++l)h=t[l]*e[l],p[l]=0<h?h+.5|0:h-.5|0;return p}(t,e),c=0;c<64;++c)d[S[c]]=u[c];var l=d[0]-n;n=d[0],0==l?I(i[0]):(I(i[f[o=32767+l]]),I(h[o]));for(var g=63;0<g&&0==d[g];g--);if(0==g)return I(s),n;for(var m,v=1;v<=g;){for(var y=v;0==d[v]&&v<=g;++v);var w=v-y;if(16<=w){m=w>>4;for(var b=1;b<=m;++b)I(a);w&=15}o=32767+d[v],I(r[(w<<4)+f[o]]),I(h[o]),v++}return 63!=g&&I(s),n}function P(t){t<=0&&(t=1),100<t&&(t=100),o!=t&&(function(t){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var i=s((e[n]*t+50)/100);i<1?i=1:255<i&&(i=255),a[S[n]]=i}for(var r=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;o<64;o++){var h=s((r[o]*t+50)/100);h<1?h=1:255<h&&(h=255),u[S[o]]=h}for(var f=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],p=0,d=0;d<8;d++)for(var g=0;g<8;g++)c[p]=1/(a[S[p]]*f[d]*f[g]*8),l[p]=1/(u[S[p]]*f[d]*f[g]*8),p++}(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),o=t)}this.encode=function(t,o){var s,h;o&&P(o),g=new Array,m=0,v=7,M(65496),M(65504),M(16),j(74),j(70),j(73),j(70),j(0),j(1),j(1),j(0),M(1),M(1),j(0),j(0),function(){M(65499),M(132),j(0);for(var t=0;t<64;t++)j(a[t]);j(1);for(var e=0;e<64;e++)j(u[e])}(),s=t.width,h=t.height,M(65472),M(17),j(8),M(h),M(s),j(3),j(1),j(17),j(0),j(2),j(17),j(1),j(3),j(17),j(1),function(){M(65476),M(418),j(0);for(var t=0;t<16;t++)j(C[t+1]);for(var e=0;e<=11;e++)j(E[e]);j(16);for(var n=0;n<16;n++)j(R[n+1]);for(var i=0;i<=161;i++)j(k[i]);j(1);for(var r=0;r<16;r++)j(T[r+1]);for(var o=0;o<=11;o++)j(F[o]);j(17);for(var s=0;s<16;s++)j(D[s+1]);for(var a=0;a<=161;a++)j(O[a])}(),M(65498),M(12),j(3),j(1),j(0),j(2),j(17),j(3),j(17),j(0),j(63),j(0);var f=0,p=0,d=0;m=0,v=7,this.encode.displayName="_encode_";for(var x,S,A,z,q,L,B,H,$,N=t.data,J=t.width,Q=t.height,G=4*J,V=0;V<Q;){for(x=0;x<G;){for(L=q=G*V+x,B=-1,$=H=0;$<64;$++)L=q+(H=$>>3)*G+(B=4*(7&$)),Q<=V+H&&(L-=G*(V+1+H-Q)),G<=x+B&&(L-=x+B-G+4),S=N[L++],A=N[L++],z=N[L++],y[$]=(_[S]+_[A+256>>0]+_[z+512>>0]>>16)-128,w[$]=(_[S+768>>0]+_[A+1024>>0]+_[z+1280>>0]>>16)-128,b[$]=(_[S+1280>>0]+_[A+1536>>0]+_[z+1792>>0]>>16)-128;f=U(y,c,f,e,i),p=U(w,l,p,n,r),d=U(b,l,d,n,r),x+=32}V+=8}if(0<=v){var W=[];W[1]=v+1,W[0]=(1<<v+1)-1,I(W)}M(65497);var X="data:image/jpeg;base64,"+btoa(g.join(""));return g=[],X},t||(t=50),function(){for(var t=String.fromCharCode,e=0;e<256;e++)x[e]=t(e)}(),e=A(C,E),n=A(T,F),i=A(R,k),r=A(D,O),function(){for(var t=1,e=2,n=1;n<=15;n++){for(var i=t;i<e;i++)f[32767+i]=n,h[32767+i]=[],h[32767+i][1]=n,h[32767+i][0]=i;for(var r=-(e-1);r<=-t;r++)f[32767+r]=n,h[32767+r]=[],h[32767+r][1]=n,h[32767+r][0]=e-1+r;t<<=1,e<<=1}}(),function(){for(var t=0;t<256;t++)_[t]=19595*t,_[t+256>>0]=38470*t,_[t+512>>0]=7471*t+32768,_[t+768>>0]=-11059*t,_[t+1024>>0]=-21709*t,_[t+1280>>0]=32768*t+8421375,_[t+1536>>0]=-27439*t,_[t+1792>>0]=-5329*t}(),P(t)}return i.encode=function(t,e){return new i(e).encode(t)},i}),s("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(t,e,n){var i,r=t.canvasToDataUrl;t.canvasToDataUrl=function(t,o,s){var a,u,c,l,h;return n.os.android?("image/jpeg"===o&&void 0===i&&(l=(l=~(h=(l=r.apply(null,arguments)).split(","))[0].indexOf("base64")?atob(h[1]):decodeURIComponent(h[1])).substring(0,2),i=255===l.charCodeAt(0)&&216===l.charCodeAt(1)),"image/jpeg"!==o||i?r.apply(null,arguments):(u=t.width,c=t.height,a=t.getContext("2d"),e.encode(a.getImageData(0,0,u,c),s))):r.apply(null,arguments)}}),s("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(t,e,n){return e.register("Image",{modified:!1,init:function(){var t=this,e=new Image;e.onload=function(){t._info={type:t.type,width:this.width,height:this.height},t._metas||"image/jpeg"!==t.type?t.owner.trigger("load"):n.parseMeta(t._blob,function(e,n){t._metas=n,t.owner.trigger("load")})},e.onerror=function(){t.owner.trigger("error")},t._img=e},loadFromBlob:function(t){var e=this._img;this._blob=t,this.type=t.type,e.src=n.createObjectURL(t.getSource()),this.owner.once("load",function(){n.revokeObjectURL(e.src)})},resize:function(t,e){var n=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,n,t,e),this._blob=null,this.modified=!0,this.owner.trigger("complete","resize")},crop:function(t,e,n,i,r){var o=this._canvas||(this._canvas=document.createElement("canvas")),s=this.options,a=this._img,u=a.naturalWidth,c=a.naturalHeight,l=this.getOrientation();r=r||1,o.width=n,o.height=i,s.preserveHeaders||this._rotate2Orientaion(o,l),this._renderImageToCanvas(o,a,-t,-e,u*r,c*r),this._blob=null,this.modified=!0,this.owner.trigger("complete","crop")},getAsBlob:function(t){var e,i=this._blob,r=this.options;if(t=t||this.type,this.modified||this.type!==t){if(e=this._canvas,"image/jpeg"===t){if(i=n.canvasToDataUrl(e,t,r.quality),r.preserveHeaders&&this._metas&&this._metas.imageHead)return i=n.dataURL2ArrayBuffer(i),i=n.updateImageHead(i,this._metas.imageHead),n.arrayBufferToBlob(i,t)}else i=n.canvasToDataUrl(e,t);i=n.dataURL2Blob(i)}return i},getAsDataUrl:function(t){var e=this.options;return"image/jpeg"===(t=t||this.type)?n.canvasToDataUrl(this._canvas,t,e.quality):this._canvas.toDataURL(t)},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(t){return t?(this._info=t,this):this._info},meta:function(t){return t?(this._metas=t,this):this._metas},destroy:function(){var t=this._canvas;this._img.onload=null,t&&(t.getContext("2d").clearRect(0,0,t.width,t.height),t.width=t.height=0,this._canvas=null),this._img.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D",this._img=this._blob=null},_resize:function(t,e,n,i){var r,o,s,a,u,c=this.options,l=t.width,h=t.height,f=this.getOrientation();~[5,6,7,8].indexOf(f)&&(n^=i,n^=i^=n),r=Math[c.crop?"max":"min"](n/l,i/h),c.allowMagnify||(r=Math.min(1,r)),o=l*r,s=h*r,c.crop?(e.width=n,e.height=i):(e.width=o,e.height=s),a=(e.width-o)/2,u=(e.height-s)/2,c.preserveHeaders||this._rotate2Orientaion(e,f),this._renderImageToCanvas(e,t,a,u,o,s)},_rotate2Orientaion:function(t,e){var n=t.width,i=t.height,r=t.getContext("2d");switch(e){case 5:case 6:case 7:case 8:t.width=i,t.height=n}switch(e){case 2:r.translate(n,0),r.scale(-1,1);break;case 3:r.translate(n,i),r.rotate(Math.PI);break;case 4:r.translate(0,i),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-i);break;case 7:r.rotate(.5*Math.PI),r.translate(n,-i),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-n,0)}},_renderImageToCanvas:function(){if(!t.os.ios)return function(e){var n=t.slice(arguments,1),i=e.getContext("2d");i.drawImage.apply(i,n)};function e(t,e,n){var i,r,o=document.createElement("canvas"),s=o.getContext("2d"),a=0,u=n,c=n;for(o.width=1,o.height=n,s.drawImage(t,0,0),i=s.getImageData(0,0,1,n).data;a<c;)0===i[4*(c-1)+3]?u=c:a=c,c=u+a>>1;return 0==(r=c/n)?1:r}return 7<=t.os.ios?function(t,n,i,r,o,s){var a=n.naturalWidth,u=n.naturalHeight,c=e(n,0,u);return t.getContext("2d").drawImage(n,0,0,a*c,u*c,i,r,o,s)}:function(t,n,i,r,o,s){var a,u,c,l,h,f,p,d,g,m,v,y=n.naturalWidth,w=n.naturalHeight,b=t.getContext("2d"),x=1048576<(v=(d=n).naturalWidth)*d.naturalHeight&&((g=document.createElement("canvas")).width=g.height=1,(m=g.getContext("2d")).drawImage(d,1-v,0),0===m.getImageData(0,0,1,1).data[3]),_="image/jpeg"===this.type,S=1024,C=0,E=0;for(x&&(y/=2,w/=2),b.save(),(a=document.createElement("canvas")).width=a.height=S,u=a.getContext("2d"),c=_?e(n,0,w):1,l=Math.ceil(S*o/y),h=Math.ceil(S*s/w/c);C<w;){for(p=f=0;f<y;)u.clearRect(0,0,S,S),u.drawImage(n,-f,-C),b.drawImage(a,0,0,S,S,i+p,r+E,l,h),f+=S,p+=l;C+=S,E+=h}b.restore(),a=u=null}}()})}),s("runtime/html5/transport",["base","runtime/html5/runtime"],function(t,e){var n=t.noop,i=t.$;return e.register("Transport",{init:function(){this._status=0,this._response=null},send:function(){var e,n,r,o=this.owner,s=this.options,a=this._initAjax(),u=o._blob,c=s.server;s.sendAsBinary?(c+=(/\?/.test(c)?"&":"?")+i.param(o._formData),n=u.getSource()):(e=new FormData,i.each(o._formData,function(t,n){e.append(t,n)}),e.append(s.fileVal,u.getSource(),s.filename||o._formData.name||"")),s.withCredentials&&"withCredentials"in a?(a.open(s.method,c,!0),a.withCredentials=!0):a.open(s.method,c),this._setRequestHeader(a,s.headers),n?(a.overrideMimeType&&a.overrideMimeType("application/octet-stream"),t.os.android?((r=new FileReader).onload=function(){a.send(this.result),r=r.onload=null},r.readAsArrayBuffer(n)):a.send(n)):a.send(e)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var t=this._xhr;t&&(t.upload.onprogress=n,t.onreadystatechange=n,t.abort(),this._xhr=t=null)},destroy:function(){this.abort()},_initAjax:function(){var t=this,e=new XMLHttpRequest;return!this.options.withCredentials||"withCredentials"in e||"undefined"==typeof XDomainRequest||(e=new XDomainRequest),e.upload.onprogress=function(e){var n=0;return e.lengthComputable&&(n=e.loaded/e.total),t.trigger("progress",n)},e.onreadystatechange=function(){if(4===e.readyState)return e.upload.onprogress=n,e.onreadystatechange=n,t._xhr=null,t._status=e.status,200<=e.status&&e.status<300?(t._response=e.responseText,t.trigger("load")):500<=e.status&&e.status<600?(t._response=e.responseText,t.trigger("error","server")):t.trigger("error",t._status?"http":"abort")},t._xhr=e},_setRequestHeader:function(t,e){i.each(e,function(e,n){t.setRequestHeader(e,n)})},_parseJson:function(t){var e;try{e=JSON.parse(t)}catch(t){e={}}return e}})}),s("runtime/html5/md5",["runtime/html5/runtime"],function(t){var e=function(t,e){return t+e&4294967295},n=function(t,n,i,r,o,s){return n=e(e(n,t),e(r,s)),e(n<<o|n>>>32-o,i)},i=function(t,e,i,r,o,s,a){return n(e&i|~e&r,t,e,o,s,a)},r=function(t,e,i,r,o,s,a){return n(e&r|i&~r,t,e,o,s,a)},o=function(t,e,i,r,o,s,a){return n(e^i^r,t,e,o,s,a)},s=function(t,e,i,r,o,s,a){return n(i^(e|~r),t,e,o,s,a)},a=function(t,n){var a=t[0],u=t[1],c=t[2],l=t[3];a=i(a,u,c,l,n[0],7,-680876936),l=i(l,a,u,c,n[1],12,-389564586),c=i(c,l,a,u,n[2],17,606105819),u=i(u,c,l,a,n[3],22,-1044525330),a=i(a,u,c,l,n[4],7,-176418897),l=i(l,a,u,c,n[5],12,1200080426),c=i(c,l,a,u,n[6],17,-1473231341),u=i(u,c,l,a,n[7],22,-45705983),a=i(a,u,c,l,n[8],7,1770035416),l=i(l,a,u,c,n[9],12,-1958414417),c=i(c,l,a,u,n[10],17,-42063),u=i(u,c,l,a,n[11],22,-1990404162),a=i(a,u,c,l,n[12],7,1804603682),l=i(l,a,u,c,n[13],12,-40341101),c=i(c,l,a,u,n[14],17,-1502002290),u=i(u,c,l,a,n[15],22,1236535329),a=r(a,u,c,l,n[1],5,-165796510),l=r(l,a,u,c,n[6],9,-1069501632),c=r(c,l,a,u,n[11],14,643717713),u=r(u,c,l,a,n[0],20,-373897302),a=r(a,u,c,l,n[5],5,-701558691),l=r(l,a,u,c,n[10],9,38016083),c=r(c,l,a,u,n[15],14,-660478335),u=r(u,c,l,a,n[4],20,-405537848),a=r(a,u,c,l,n[9],5,568446438),l=r(l,a,u,c,n[14],9,-1019803690),c=r(c,l,a,u,n[3],14,-187363961),u=r(u,c,l,a,n[8],20,1163531501),a=r(a,u,c,l,n[13],5,-1444681467),l=r(l,a,u,c,n[2],9,-51403784),c=r(c,l,a,u,n[7],14,1735328473),u=r(u,c,l,a,n[12],20,-1926607734),a=o(a,u,c,l,n[5],4,-378558),l=o(l,a,u,c,n[8],11,-2022574463),c=o(c,l,a,u,n[11],16,1839030562),u=o(u,c,l,a,n[14],23,-35309556),a=o(a,u,c,l,n[1],4,-1530992060),l=o(l,a,u,c,n[4],11,1272893353),c=o(c,l,a,u,n[7],16,-155497632),u=o(u,c,l,a,n[10],23,-1094730640),a=o(a,u,c,l,n[13],4,681279174),l=o(l,a,u,c,n[0],11,-358537222),c=o(c,l,a,u,n[3],16,-722521979),u=o(u,c,l,a,n[6],23,76029189),a=o(a,u,c,l,n[9],4,-640364487),l=o(l,a,u,c,n[12],11,-421815835),c=o(c,l,a,u,n[15],16,530742520),u=o(u,c,l,a,n[2],23,-995338651),a=s(a,u,c,l,n[0],6,-198630844),l=s(l,a,u,c,n[7],10,1126891415),c=s(c,l,a,u,n[14],15,-1416354905),u=s(u,c,l,a,n[5],21,-57434055),a=s(a,u,c,l,n[12],6,1700485571),l=s(l,a,u,c,n[3],10,-1894986606),c=s(c,l,a,u,n[10],15,-1051523),u=s(u,c,l,a,n[1],21,-2054922799),a=s(a,u,c,l,n[8],6,1873313359),l=s(l,a,u,c,n[15],10,-30611744),c=s(c,l,a,u,n[6],15,-1560198380),u=s(u,c,l,a,n[13],21,1309151649),a=s(a,u,c,l,n[4],6,-145523070),l=s(l,a,u,c,n[11],10,-1120210379),c=s(c,l,a,u,n[2],15,718787259),u=s(u,c,l,a,n[9],21,-343485551),t[0]=e(a,t[0]),t[1]=e(u,t[1]),t[2]=e(c,t[2]),t[3]=e(l,t[3])},u=function(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n},c=function(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return n},l=function(t){var e,n,i,r,o,s,c=t.length,l=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=c;e+=64)a(l,u(t.substring(e-64,e)));for(n=(t=t.substring(e-64)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)i[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),55<e)for(a(l,i),e=0;e<16;e+=1)i[e]=0;return r=(r=8*c).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(r[2],16),s=parseInt(r[1],16)||0,i[14]=o,i[15]=s,a(l,i),l},h=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],f=function(t){var e,n="";for(e=0;e<4;e+=1)n+=h[t>>8*e+4&15]+h[t>>8*e&15];return n},p=function(t){var e;for(e=0;e<t.length;e+=1)t[e]=f(t[e]);return t.join("")},d=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==p(l("hello"))&&(e=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}),d.prototype.append=function(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),this.appendBinary(t),this},d.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,n=this._buff.length;for(e=64;e<=n;e+=64)a(this._state,u(this._buff.substring(e-64,e)));return this._buff=this._buff.substr(e-64),this},d.prototype.end=function(t){var e,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<r;e+=1)o[e>>2]|=i.charCodeAt(e)<<(e%4<<3);return this._finish(o,r),n=t?this._state:p(this._state),this.reset(),n},d.prototype._finish=function(t,e){var n,i,r,o=e;if(t[o>>2]|=128<<(o%4<<3),55<o)for(a(this._state,t),o=0;o<16;o+=1)t[o]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),r=parseInt(n[1],16)||0,t[14]=i,t[15]=r,a(this._state,t)},d.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},d.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},d.hash=function(t,e){/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t)));var n=l(t);return e?n:p(n)},d.hashBinary=function(t,e){var n=l(t);return e?n:p(n)},(d.ArrayBuffer=function(){this.reset()}).prototype.append=function(t){var e,n=this._concatArrayBuffer(this._buff,t),i=n.length;for(this._length+=t.byteLength,e=64;e<=i;e+=64)a(this._state,c(n.subarray(e-64,e)));return this._buff=e-64<i?n.subarray(e-64):new Uint8Array(0),this},d.ArrayBuffer.prototype.end=function(t){var e,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<r;e+=1)o[e>>2]|=i[e]<<(e%4<<3);return this._finish(o,r),n=t?this._state:p(this._state),this.reset(),n},d.ArrayBuffer.prototype._finish=d.prototype._finish,d.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},d.ArrayBuffer.prototype.destroy=d.prototype.destroy,d.ArrayBuffer.prototype._concatArrayBuffer=function(t,e){var n=t.length,i=new Uint8Array(n+e.byteLength);return i.set(t),i.set(new Uint8Array(e),n),i},d.ArrayBuffer.hash=function(t,e){var n=function(t){var e,n,i,r,o,s,u=t.length,l=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=u;e+=64)a(l,c(t.subarray(e-64,e)));for(n=(t=e-64<u?t.subarray(e-64):new Uint8Array(0)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)i[e>>2]|=t[e]<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),55<e)for(a(l,i),e=0;e<16;e+=1)i[e]=0;return r=(r=8*u).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(r[2],16),s=parseInt(r[1],16)||0,i[14]=o,i[15]=s,a(l,i),l}(new Uint8Array(t));return e?n:p(n)},t.register("Md5",{init:function(){},loadFromBlob:function(t){var e,n,i=t.getSource(),r=2097152,o=Math.ceil(i.size/r),s=0,a=this.owner,u=new d.ArrayBuffer,c=this,l=i.mozSlice||i.webkitSlice||i.slice;n=new FileReader,(e=function(){var h,f;h=s*r,f=Math.min(h+r,i.size),n.onload=function(e){u.append(e.target.result),a.trigger("progress",{total:t.size,loaded:f})},n.onloadend=function(){n.onloadend=n.onload=null,++s<o?setTimeout(e,1):setTimeout(function(){a.trigger("load"),c.result=u.end(),e=t=i=u=null,a.trigger("complete")},50)},n.readAsArrayBuffer(l.call(i,h,f))})()},getResult:function(){return this.result}})}),s("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(t,e,n){var i=t.$,r={};function s(){var n={},i={},s=this.destroy,a=this,u=t.guid("webuploader_");e.apply(a,arguments),a.type="flash",a.exec=function(e,o){var s,u=this.uid,c=t.slice(arguments,2);return i[u]=this,r[e]&&(n[u]||(n[u]=new r[e](this,a)),(s=n[u])[o])?s[o].apply(s,c):a.flashExec.apply(this,arguments)},o[u]=function(){var t=arguments;setTimeout(function(){(function(t,e){var n,r,o=t.type||t;r=(n=o.split("::"))[0],"Ready"===(o=n[1])&&r===a.uid?a.trigger("ready"):i[r]&&i[r].trigger(o.toLowerCase(),t,e)}).apply(null,t)},1)},this.jsreciver=u,this.destroy=function(){return s&&s.apply(this,arguments)},this.flashExec=function(e,n){var i=a.getFlash(),r=t.slice(arguments,2);return i.exec(this.uid,e,n,r)}}return t.inherits(e,{constructor:s,init:function(){var e,n=this.getContainer(),i=this.options;n.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),e='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+i.swf+'" ',t.browser.ie&&(e+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),e+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+i.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',n.html(e)},getFlash:function(){return this._flash||(this._flash=i("#"+this.uid).get(0)),this._flash}}),s.register=function(e,o){return r[e]=t.inherits(n,i.extend({flashExec:function(){var t=this.owner;return this.getRuntime().flashExec.apply(t,arguments)}},o))},11.4<=function(){var t;try{t=(t=navigator.plugins["Shockwave Flash"]).description}catch(e){try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(e){t="0.0"}}return t=t.match(/\d+/g),parseFloat(t[0]+"."+t[1],10)}()&&e.addRuntime("flash",s),s}),s("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(t,e){var n=t.$;return e.register("FilePicker",{init:function(t){var e,i,r=n.extend({},t);for(e=r.accept&&r.accept.length,i=0;i<e;i++)r.accept[i].title||(r.accept[i].title="Files");delete r.button,delete r.id,delete r.container,this.flashExec("FilePicker","init",r)},destroy:function(){this.flashExec("FilePicker","destroy")}})}),s("runtime/flash/image",["runtime/flash/runtime"],function(t){return t.register("Image",{loadFromBlob:function(t){var e=this.owner;e.info()&&this.flashExec("Image","info",e.info()),e.meta()&&this.flashExec("Image","meta",e.meta()),this.flashExec("Image","loadFromBlob",t.uid)}})}),s("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(t,e,n){var i=t.$;return e.register("Transport",{init:function(){this._status=0,this._response=null,this._responseJson=null},send:function(){var t,e=this.owner,n=this.options,r=this._initAjax(),o=e._blob,s=n.server;r.connectRuntime(o.ruid),n.sendAsBinary?(s+=(/\?/.test(s)?"&":"?")+i.param(e._formData),t=o.uid):(i.each(e._formData,function(t,e){r.exec("append",t,e)}),r.exec("appendBlob",n.fileVal,o.uid,n.filename||e._formData.name||"")),this._setRequestHeader(r,n.headers),r.exec("send",{method:n.method,url:s,forceURLStream:n.forceURLStream,mimeType:"application/octet-stream"},t)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var t=this._xhr;t&&(t.exec("abort"),t.destroy(),this._xhr=t=null)},destroy:function(){this.abort()},_initAjax:function(){var t=this,e=new n("XMLHttpRequest");return e.on("uploadprogress progress",function(e){var n=e.loaded/e.total;return n=Math.min(1,Math.max(0,n)),t.trigger("progress",n)}),e.on("load",function(){var n,i=e.exec("getStatus"),r=!1,s="";return e.off(),t._xhr=null,200<=i&&i<300?r=!0:s=500<=i&&i<600?(r=!0,"server"):"http",r&&(t._response=e.exec("getResponse"),t._response=decodeURIComponent(t._response),n=function(t){try{return o.JSON&&o.JSON.parse?JSON.parse(t):new Function("return "+t).call()}catch(t){return{}}},t._responseJson=t._response?n(t._response):{}),e.destroy(),e=null,s?t.trigger("error",s):t.trigger("load")}),e.on("error",function(){e.off(),t._xhr=null,t.trigger("error","http")}),t._xhr=e},_setRequestHeader:function(t,e){i.each(e,function(e,n){t.exec("setRequestHeader",e,n)})}})}),s("runtime/flash/blob",["runtime/flash/runtime","lib/blob"],function(t,e){return t.register("Blob",{slice:function(t,n){var i=this.flashExec("Blob","slice",t,n);return new e(this.getRuid(),i)}})}),s("runtime/flash/md5",["runtime/flash/runtime"],function(t){return t.register("Md5",{init:function(){},loadFromBlob:function(t){return this.flashExec("Md5","loadFromBlob",t.uid)}})}),s("preset/all",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","widgets/md5","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/androidpatch","runtime/html5/image","runtime/html5/transport","runtime/html5/md5","runtime/flash/filepicker","runtime/flash/image","runtime/flash/transport","runtime/flash/blob","runtime/flash/md5"],function(t){return t}),s("widgets/log",["base","uploader","widgets/widget"],function(t,e){var n,i=t.$,r=(location.hostname||location.host||"protected").toLowerCase();if(r&&/baidu/i.exec(r))return n={dv:3,master:"webuploader",online:/test/.exec(r)?0:1,module:"",product:r,type:0},e.register({name:"log",init:function(){var t=0,e=0;this.owner.on("error",function(t){o({type:2,c_error_code:t})}).on("uploadError",function(t,e){o({type:2,c_error_code:"UPLOAD_ERROR",c_reason:""+e})}).on("uploadComplete",function(n){t++,e+=n.size}).on("uploadFinished",function(){o({c_count:t,c_size:e}),t=e=0}),o({c_usage:1})}});function o(t){var e=i.extend({},n,t),r=" http://static.tieba.baidu.com/tb/pms/img/st.gif??".replace(/^(.*)\?/,"$1"+i.param(e));(new Image).src=r}}),s("webuploader",["preset/all","widgets/log"],function(t){return t}),a("webuploader"))))},function(t,e,n){"use strict";var i=s(n(6)),r=s(n(61)),o=s(n(62));function s(t){return t&&t.__esModule?t:{default:t}}n(66),t.exports=function(){function t(e,n,o){var s=this;(0,r.default)(this,t),$("body").find("#cropper").length||(this.jcropApi={},this.$element=e,this._createImage(),this.config=(0,i.default)({trueSize:[this.img.width,this.img.height],setSelect:[0,0,this.img.width,this.img.height],aspectRatio:1,keySupport:!1,allowSelect:!1,onSelect:function(t){s.selectData=t}},n),this.init(),this.callback=o)}return(0,o.default)(t,[{key:"_createImage",value:function(){var t=new Image;t.src=this.$element.attr("src"),this.img=t}},{key:"init",value:function(){var t=new Image;t.src=this.$element.attr("src"),t.complete?this._initImage(t):t.onload=function(){this._initImage(t)},$("body").on("click",".cropper-close-btn",function(){$("#cropper").remove()})}},{key:"_initImage",value:function(t){var e=this,n=$("body"),i=$('<div id="cropper" class="cropper">\n      <div class="cropper-image">\n        <i class="iconfont icon-loadingspinner circle"></i>\n      </div>\n    </div>');n.append(i);var r=i.find(".cropper-image"),o=.5*n.width(),s=.5*n.height(),a=t.width;t.width>o?(r.width(o),r.height(t.height/(t.width/o))):r.width(t.width),t.height>s?(r.height(s),r.width(t.width/(t.height/s))):r.height(t.height),r.css({marginLeft:r.width()/-2,marginTop:r.height()/-2}),r.html(t).append("<span class='cropper-close-btn btn btn-primary'>关闭</span><span class='js-cropper-btn btn btn-primary'>截图</span>");var u=this;$(t).Jcrop(this.config,function(){u.jcropApi=this}),$("#cropper").on("click",".js-cropper-btn",function(){var n=a/$(t).width(),i=e.jcropApi.ui.selection.last,r={width:n*i.w,height:n*i.h,x:n*i.x,y:n*i.y,value:e.$element.attr("src")};$.post(e.config.url,r,function(t){e.$element.attr("src",t.path),$("#cropper").remove(),"function"==typeof e.callback&&e.callback(t)})})}}]),t}()},function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,n){"use strict";e.__esModule=!0;var i,r=(i=n(63))&&i.__esModule?i:{default:i};e.default=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,r.default)(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()},function(t,e,n){t.exports={default:n(64),__esModule:!0}},function(t,e,n){n(65);var i=n(0).Object;t.exports=function(t,e,n){return i.defineProperty(t,e,n)}},function(t,e,n){var i=n(7);i(i.S+i.F*!n(1),"Object",{defineProperty:n(8).f})},function(t,e){!function(t){"use strict";var e=function(n,i){var r=navigator.userAgent.toLowerCase();this.opt=t.extend({},e.defaults,i||{}),this.container=t(n),this.opt.is_msie=/msie/.test(r),this.opt.is_ie_lt9=/msie [1-8]\./.test(r),this.container.addClass(this.opt.css_container),this.ui={},this.state=null,this.ui.multi=[],this.ui.selection=null,this.filter={},this.init(),this.setOptions(i),this.applySizeConstraints(),this.container.trigger("cropinit",this),this.opt.is_ie_lt9&&(this.opt.dragEventTarget=document.body)};t.extend(e,{component:{},filter:{},stage:{},registerComponent:function(t,n){e.component[t]=n},registerFilter:function(t,n){e.filter[t]=n},registerStageType:function(t,n){e.stage[t]=n},attach:function(e,n){return new t.Jcrop(e,n)},imgCopy:function(t){var e=new Image;return e.src=t.src,e},imageClone:function(n){return t.Jcrop.supportsCanvas?e.canvasClone(n):e.imgCopy(n)},canvasClone:function(e){var n=document.createElement("canvas"),i=n.getContext("2d");return t(n).width(e.width).height(e.height),n.width=e.naturalWidth,n.height=e.naturalHeight,i.drawImage(e,0,0,e.naturalWidth,e.naturalHeight),n},propagate:function(t,e,n){for(var i=0,r=t.length;i<r;i++)e.hasOwnProperty(t[i])&&(n[t[i]]=e[t[i]])},getLargestBox:function(t,e,n){return t<e/n?[n*t,n]:[e,e/t]},stageConstructor:function(n,i,r){var o=[];t.each(e.stage,function(t,e){o.push(e)}),o.sort(function(t,e){return t.priority-e.priority});for(var s=0,a=o.length;s<a;s++)if(o[s].isSupported(n,i)){o[s].create(n,i,function(t,e){"function"==typeof r&&r(t,e)});break}},supportsColorFade:function(){return t.fx.step.hasOwnProperty("backgroundColor")},wrapFromXywh:function(t){var e={x:t[0],y:t[1],w:t[2],h:t[3]};return e.x2=e.x+e.w,e.y2=e.y+e.h,e}});var i=function(){};t.extend(i,{isSupported:function(t,e){return!0},priority:100,create:function(t,e,n){var r=new i;r.element=t,n.call(this,r,e)},prototype:{attach:function(t){this.init(t),t.ui.stage=this},triggerEvent:function(e){return t(this.element).trigger(e),this},getElement:function(){return this.element}}}),e.registerStageType("Block",i);var r=function(){};r.prototype=new i,t.extend(r,{isSupported:function(t,e){return"IMG"==t.tagName||void 0},priority:90,create:function(e,n,i){t.Jcrop.component.ImageLoader.attach(e,function(o,s){var a=new r;a.element=t(e).wrap("<div />").parent(),a.element.width(o).height(s),a.imgsrc=e,"function"==typeof i&&i.call(this,a,n)})}}),e.registerStageType("Image",r);var o=function(){this.angle=0,this.scale=1,this.scaleMin=.2,this.scaleMax=1.25,this.offset=[0,0]};o.prototype=new r,t.extend(o,{isSupported:function(e,n){return!(!t.Jcrop.supportsCanvas||"IMG"!=e.tagName)||void 0},priority:60,create:function(e,n,i){var r=t(e),s=t.extend({},n);t.Jcrop.component.ImageLoader.attach(e,function(t,n){var a=new o;r.hide(),a.createCanvas(e,t,n),r.before(a.element),a.imgsrc=e,s.imgsrc=e,"function"==typeof i&&(i(a,s),a.redraw())})}}),t.extend(o.prototype,{init:function(t){this.core=t},setOffset:function(t,e){return this.offset=[t,e],this},setAngle:function(t){return this.angle=t,this},setScale:function(t){return this.scale=this.boundScale(t),this},boundScale:function(t){return t<this.scaleMin?t=this.scaleMin:t>this.scaleMax&&(t=this.scaleMax),t},createCanvas:function(e,n,i){this.width=n,this.height=i,this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=i,this.$canvas=t(this.canvas).width("100%").height("100%"),this.context=this.canvas.getContext("2d"),this.fillstyle="rgb(0,0,0)",this.element=this.$canvas.wrap("<div />").parent().width(n).height(i)},triggerEvent:function(t){return this.$canvas.trigger(t),this},clear:function(){return this.context.fillStyle=this.fillstyle,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this},redraw:function(){return this.context.save(),this.clear(),this.context.translate(parseInt(.5*this.width),parseInt(.5*this.height)),this.context.translate(this.offset[0]/this.core.opt.xscale,this.offset[1]/this.core.opt.yscale),this.context.rotate(this.angle*(Math.PI/180)),this.context.scale(this.scale,this.scale),this.context.translate(-parseInt(.5*this.width),-parseInt(.5*this.height)),this.context.drawImage(this.imgsrc,0,0,this.width,this.height),this.context.restore(),this.$canvas.trigger("cropredraw"),this},setFillStyle:function(t){return this.fillstyle=t,this}}),e.registerStageType("Canvas",o);var s=function(){this.minw=40,this.minh=40,this.maxw=0,this.maxh=0,this.core=null};t.extend(s.prototype,{tag:"backoff",priority:22,filter:function(t){var e=this.bound;return t.x<e.minx&&(t.x=e.minx,t.x2=t.w+t.x),t.y<e.miny&&(t.y=e.miny,t.y2=t.h+t.y),t.x2>e.maxx&&(t.x2=e.maxx,t.x=t.x2-t.w),t.y2>e.maxy&&(t.y2=e.maxy,t.y=t.y2-t.h),t},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.bound={minx:0+t.edge.w,miny:0+t.edge.n,maxx:this.elw+t.edge.e,maxy:this.elh+t.edge.s}}}),e.registerFilter("backoff",s);var a=function(){this.core=null};t.extend(a.prototype,{tag:"constrain",priority:5,filter:function(t,e){return"move"==e?(t.x<this.minx&&(t.x=this.minx,t.x2=t.w+t.x),t.y<this.miny&&(t.y=this.miny,t.y2=t.h+t.y),t.x2>this.maxx&&(t.x2=this.maxx,t.x=t.x2-t.w),t.y2>this.maxy&&(t.y2=this.maxy,t.y=t.y2-t.h)):(t.x<this.minx&&(t.x=this.minx),t.y<this.miny&&(t.y=this.miny),t.x2>this.maxx&&(t.x2=this.maxx),t.y2>this.maxy&&(t.y2=this.maxy)),t.w=t.x2-t.x,t.h=t.y2-t.y,t},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.minx=0+t.edge.w,this.miny=0+t.edge.n,this.maxx=this.elw+t.edge.e,this.maxy=this.elh+t.edge.s}}),e.registerFilter("constrain",a);var u=function(){this.core=null};t.extend(u.prototype,{tag:"extent",priority:12,offsetFromCorner:function(t,e,n){var i=e[0],r=e[1];switch(t){case"bl":return[n.x2-i,n.y,i,r];case"tl":return[n.x2-i,n.y2-r,i,r];case"br":return[n.x,n.y,i,r];case"tr":return[n.x,n.y2-r,i,r]}},getQuadrant:function(t){var e=t.opposite[0]-t.offsetx,n=t.opposite[1]-t.offsety;return e<0&&n<0?"br":0<=e&&0<=n?"tl":e<0&&0<=n?"tr":"bl"},filter:function(t,n,i){if("move"==n)return t;var r=t.w,o=t.h,s=i.state,a=this.limits,u=s?this.getQuadrant(s):"br";return a.minw&&r<a.minw&&(r=a.minw),a.minh&&o<a.minh&&(o=a.minh),a.maxw&&r>a.maxw&&(r=a.maxw),a.maxh&&o>a.maxh&&(o=a.maxh),r==t.w&&o==t.h?t:e.wrapFromXywh(this.offsetFromCorner(u,[r,o],t))},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.limits={minw:t.minSize[0],minh:t.minSize[1],maxw:t.maxSize[0],maxh:t.maxSize[1]}}}),e.registerFilter("extent",u);var c=function(){this.stepx=1,this.stepy=1,this.core=null};t.extend(c.prototype,{tag:"grid",priority:19,filter:function(t){var e={x:Math.round(t.x/this.stepx)*this.stepx,y:Math.round(t.y/this.stepy)*this.stepy,x2:Math.round(t.x2/this.stepx)*this.stepx,y2:Math.round(t.y2/this.stepy)*this.stepy};return e.w=e.x2-e.x,e.h=e.y2-e.y,e}}),e.registerFilter("grid",c);var l=function(){this.ratio=0,this.core=null};t.extend(l.prototype,{tag:"ratio",priority:15,offsetFromCorner:function(t,e,n){var i=e[0],r=e[1];switch(t){case"bl":return[n.x2-i,n.y,i,r];case"tl":return[n.x2-i,n.y2-r,i,r];case"br":return[n.x,n.y,i,r];case"tr":return[n.x,n.y2-r,i,r]}},getBoundRatio:function(t,n){var i=e.getLargestBox(this.ratio,t.w,t.h);return e.wrapFromXywh(this.offsetFromCorner(n,i,t))},getQuadrant:function(t){var e=t.opposite[0]-t.offsetx,n=t.opposite[1]-t.offsety;return e<0&&n<0?"br":0<=e&&0<=n?"tl":e<0&&0<=n?"tr":"bl"},filter:function(t,e,n){if(!this.ratio)return t;var i=(t.w,t.h,n.state),r=i?this.getQuadrant(i):"br";if("move"==(e=e||"se"))return t;switch(e){case"n":t.x2=this.elw,t.w=t.x2-t.x,r="tr";break;case"s":t.x2=this.elw,t.w=t.x2-t.x,r="br";break;case"e":t.y2=this.elh,t.h=t.y2-t.y,r="br";break;case"w":t.y2=this.elh,t.h=t.y2-t.y,r="bl"}return this.getBoundRatio(t,r)},refresh:function(t){this.ratio=t.aspectRatio,this.elw=t.core.container.width(),this.elh=t.core.container.height()}}),e.registerFilter("ratio",l);var h=function(){this.core=null};t.extend(h.prototype,{tag:"round",priority:90,filter:function(t){var e={x:Math.round(t.x),y:Math.round(t.y),x2:Math.round(t.x2),y2:Math.round(t.y2)};return e.w=e.x2-e.x,e.h=e.y2-e.y,e}}),e.registerFilter("round",h);var f=function(t,e){this.color=e||"black",this.opacity=t||.5,this.core=null,this.shades={}};t.extend(f.prototype,{tag:"shader",fade:!0,fadeEasing:"swing",fadeSpeed:320,priority:95,init:function(){var e=this;e.attached||(e.visible=!1,e.container=t("<div />").addClass(e.core.opt.css_shades).prependTo(this.core.container).hide(),e.elh=this.core.container.height(),e.elw=this.core.container.width(),e.shades={top:e.createShade(),right:e.createShade(),left:e.createShade(),bottom:e.createShade()},e.attached=!0)},destroy:function(){this.container.remove()},setColor:function(n,i){var r=this;if(n==r.color)return r;this.color=n;var o=e.supportsColorFade();return t.each(r.shades,function(t,e){r.fade&&!i&&o?e.animate({backgroundColor:n},{queue:!1,duration:r.fadeSpeed,easing:r.fadeEasing}):e.css("backgroundColor",n)}),r},setOpacity:function(e,n){var i=this;return e==i.opacity||(i.opacity=e,t.each(i.shades,function(t,r){!i.fade||n?r.css({opacity:e}):r.animate({opacity:e},{queue:!1,duration:i.fadeSpeed,easing:i.fadeEasing})})),i},createShade:function(){return t("<div />").css({position:"absolute",backgroundColor:this.color,opacity:this.opacity}).appendTo(this.container)},refresh:function(t){var e=this.core,n=this.shades;this.setColor(t.bgColor?t.bgColor:this.core.opt.bgColor),this.setOpacity(t.bgOpacity?t.bgOpacity:this.core.opt.bgOpacity),this.elh=e.container.height(),this.elw=e.container.width(),n.right.css("height",this.elh+"px"),n.left.css("height",this.elh+"px")},filter:function(t,e,n){if(!n.active)return t;var i=this,r=i.shades;return r.top.css({left:Math.round(t.x)+"px",width:Math.round(t.w)+"px",height:Math.round(t.y)+"px"}),r.bottom.css({top:Math.round(t.y2)+"px",left:Math.round(t.x)+"px",width:Math.round(t.w)+"px",height:i.elh-Math.round(t.y2)+"px"}),r.right.css({left:Math.round(t.x2)+"px",width:i.elw-Math.round(t.x2)+"px"}),r.left.css({width:Math.round(t.x)+"px"}),i.visible||(i.container.show(),i.visible=!0),t}}),e.registerFilter("shader",f);var p=function(t){this.stage=t,this.core=t.core,this.cloneStagePosition()};p.prototype={cloneStagePosition:function(){var t=this.stage;this.angle=t.angle,this.scale=t.scale,this.offset=t.offset},getElement:function(){var e=this.stage;return t("<div />").css({position:"absolute",top:e.offset[0]+"px",left:e.offset[1]+"px",width:e.angle+"px",height:e.scale+"px"})},animate:function(t){var e=this;this.scale=this.stage.boundScale(this.scale),e.stage.triggerEvent("croprotstart"),e.getElement().animate({top:e.offset[0]+"px",left:e.offset[1]+"px",width:e.angle+"px",height:e.scale+"px"},{easing:e.core.opt.animEasing,duration:e.core.opt.animDuration,complete:function(){e.stage.triggerEvent("croprotend"),"function"==typeof t&&t.call(this)},progress:function(t){var n,i={},r=t.tweens;for(n=0;n<r.length;n++)i[r[n].prop]=r[n].now;e.stage.setAngle(i.width).setScale(i.height).setOffset(i.top,i.left).redraw()}})}},e.stage.Canvas.prototype.getAnimator=function(){return new p(this)},e.registerComponent("CanvasAnimator",p);var d=function(t){this.selection=t,this.core=t.core};d.prototype={getElement:function(){var e=this.selection.get();return t("<div />").css({position:"absolute",top:e.y+"px",left:e.x+"px",width:e.w+"px",height:e.h+"px"})},animate:function(t,e,n,i,r){var o=this;o.selection.allowResize(!1),o.getElement().animate({top:e+"px",left:t+"px",width:n+"px",height:i+"px"},{easing:o.core.opt.animEasing,duration:o.core.opt.animDuration,complete:function(){o.selection.allowResize(!0),r&&r.call(this)},progress:function(t){var e,n={},i=t.tweens;for(e=0;e<i.length;e++)n[i[e].prop]=i[e].now;var r={x:parseInt(n.left),y:parseInt(n.top),w:parseInt(n.width),h:parseInt(n.height)};r.x2=r.x+r.w,r.y2=r.y+r.h,o.selection.updateRaw(r,"se")}})}},e.registerComponent("Animator",d);var g=function(t,e,n){var i=this;i.x=t.pageX,i.y=t.pageY,i.selection=e,i.eventTarget=e.core.opt.dragEventTarget,i.orig=e.get(),e.callFilterFunction("refresh");var r=e.core.container.position();i.elx=r.left,i.ely=r.top,i.offsetx=0,i.offsety=0,i.ord=n,i.opposite=i.getOppositeCornerOffset(),i.initEvents(t)};g.prototype={getOppositeCornerOffset:function(){var t=this.orig,e=this.x-this.elx-t.x,n=this.y-this.ely-t.y;switch(this.ord){case"nw":case"w":return[t.w-e,t.h-n];case"sw":return[t.w-e,-n];case"se":case"s":case"e":return[-e,-n];case"ne":case"n":return[-e,t.h-n]}return[null,null]},initEvents:function(e){t(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())},dragEvent:function(t){this.offsetx=t.pageX-this.x,this.offsety=t.pageY-this.y,this.selection.updateRaw(this.getBox(),this.ord)},endDragEvent:function(t){var e=this.selection;e.core.container.removeClass("jcrop-dragging"),e.element.trigger("cropend",[e,e.core.unscale(e.get())]),e.focus()},createStopHandler:function(){var e=this;return function(n){return t(e.eventTarget).off(".jcrop"),e.endDragEvent(n),!1}},createDragHandler:function(){var t=this;return function(e){return t.dragEvent(e),!1}},update:function(t,e){this.offsetx=t-this.x,this.offsety=e-this.y},resultWrap:function(t){var e={x:Math.min(t[0],t[2]),y:Math.min(t[1],t[3]),x2:Math.max(t[0],t[2]),y2:Math.max(t[1],t[3])};return e.w=e.x2-e.x,e.h=e.y2-e.y,e},getBox:function(){var t=this,e=t.orig,n={x2:e.x+e.w,y2:e.y+e.h};switch(t.ord){case"n":return t.resultWrap([e.x,t.offsety+e.y,n.x2,n.y2]);case"s":return t.resultWrap([e.x,e.y,n.x2,t.offsety+n.y2]);case"e":return t.resultWrap([e.x,e.y,t.offsetx+n.x2,n.y2]);case"w":return t.resultWrap([e.x+t.offsetx,e.y,n.x2,n.y2]);case"sw":return t.resultWrap([t.offsetx+e.x,e.y,n.x2,t.offsety+n.y2]);case"se":return t.resultWrap([e.x,e.y,t.offsetx+n.x2,t.offsety+n.y2]);case"ne":return t.resultWrap([e.x,t.offsety+e.y,t.offsetx+n.x2,n.y2]);case"nw":return t.resultWrap([t.offsetx+e.x,t.offsety+e.y,n.x2,n.y2]);case"move":return n.nx=e.x+t.offsetx,n.ny=e.y+t.offsety,t.resultWrap([n.nx,n.ny,n.nx+e.w,n.ny+e.h])}}},e.registerComponent("DragState",g);var m=function(t){this.core=t};m.prototype={on:function(e,n){t(this).on(e,n)},off:function(e){t(this).off(e)},trigger:function(e){t(this).trigger(e)}},e.registerComponent("EventManager",m);var v=function(t,e,n){this.src=t,e||(e=new Image),this.element=e,this.callback=n,this.load()};t.extend(v,{attach:function(t,e){return new v(t.src,t,e)},prototype:{getDimensions:function(){var t=this.element;return t.naturalWidth?[t.naturalWidth,t.naturalHeight]:t.width?[t.width,t.height]:null},fireCallback:function(){this.element.onload=null,"function"==typeof this.callback&&this.callback.apply(this,this.getDimensions())},isLoaded:function(){return this.element.complete},load:function(){var t=this;t.element.src=t.src,t.isLoaded()?t.fireCallback():t.element.onload=function(e){t.fireCallback()}}}}),e.registerComponent("ImageLoader",v);var y=function(t){this.core=t,this.init()};t.extend(y,{support:function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)||void 0},prototype:{init:function(){var e=t.Jcrop.component.DragState.prototype;e.touch||(this.initEvents(),this.shimDragState(),this.shimStageDrag(),e.touch=!0)},shimDragState:function(){var e=this;t.Jcrop.component.DragState.prototype.initEvents=function(n){"touch"==n.type.substr(0,5)?t(this.eventTarget).on("touchmove.jcrop.jcrop-touch",e.dragWrap(this.createDragHandler())).on("touchend.jcrop.jcrop-touch",this.createStopHandler()):t(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())}},shimStageDrag:function(){this.core.container.addClass("jcrop-touch").on("touchstart.jcrop.jcrop-stage",this.dragWrap(this.core.ui.manager.startDragHandler()))},dragWrap:function(t){return function(e){return e.preventDefault(),e.stopPropagation(),"touch"==e.type.substr(0,5)&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,t(e))}},initEvents:function(){var t=this.core;t.container.on("touchstart.jcrop.jcrop-touch","."+t.opt.css_drag,this.dragWrap(t.startDrag()))}}}),e.registerComponent("Touch",y);var w=function(t){this.core=t,this.init()};t.extend(w,{defaults:{eventName:"keydown.jcrop",passthru:[9],debug:!1},prototype:{init:function(){t.extend(this,w.defaults),this.enable()},disable:function(){this.core.container.off(this.eventName)},enable:function(){var e=this,n=e.core;n.container.on(e.eventName,function(i){var r=i.shiftKey?16:2;if(0<=t.inArray(i.keyCode,e.passthru))return!0;switch(i.keyCode){case 37:n.nudge(-r,0);break;case 38:n.nudge(0,-r);break;case 39:n.nudge(r,0);break;case 40:n.nudge(0,r);break;case 46:case 8:return n.requestDelete(),!1;default:e.debug&&console.log("keycode: "+i.keyCode)}i.metaKey||i.ctrlKey||i.preventDefault()})}}}),e.registerComponent("Keyboard",w);var b=function(){};t.extend(b,{defaults:{minSize:[8,8],maxSize:[0,0],aspectRatio:0,edge:{n:0,s:0,e:0,w:0},bgColor:null,bgOpacity:null,last:null,state:null,active:!0,linked:!0,canDelete:!0,canDrag:!0,canResize:!0,canSelect:!0},prototype:{init:function(t){this.core=t,this.startup(),this.linked=this.core.opt.linked,this.attach(),this.setOptions(this.core.opt),t.container.trigger("cropcreate",[this])},attach:function(){},startup:function(){var e=this,n=e.core.opt;t.extend(e,b.defaults),e.filter=e.core.getDefaultFilters(),e.element=t("<div />").addClass(n.css_selection).data({selection:e}),e.frame=t("<button />").addClass(n.css_button).data("ord","move").attr("type","button"),e.element.append(e.frame).appendTo(e.core.container),e.core.opt.is_msie&&e.frame.css({opacity:0,backgroundColor:"white"}),e.insertElements(),e.frame.on("focus.jcrop",function(t){e.core.setSelection(e),e.element.trigger("cropfocus",e),e.element.addClass("jcrop-focus")}).on("blur.jcrop",function(t){e.element.removeClass("jcrop-focus"),e.element.trigger("cropblur",e)})},propagate:["canDelete","canDrag","canResize","canSelect","minSize","maxSize","aspectRatio","edge"],setOptions:function(t){return e.propagate(this.propagate,t,this),this.refresh(),this},refresh:function(){this.allowResize(),this.allowDrag(),this.allowSelect(),this.callFilterFunction("refresh"),this.updateRaw(this.get(),"se")},callFilterFunction:function(t,e){for(var n=0;n<this.filter.length;n++)this.filter[n][t]&&this.filter[n][t](this);return this},addFilter:function(t){t.core=this.core,this.hasFilter(t)||(this.filter.push(t),this.sortFilters(),t.init&&t.init(),this.refresh())},hasFilter:function(t){var e,n=this.filter;for(e=0;e<n.length;e++)if(n[e]===t)return!0},sortFilters:function(){this.filter.sort(function(t,e){return t.priority-e.priority})},clearFilters:function(){for(var t=this.filter,e=0;e<t.length;e++)t[e].destroy&&t[e].destroy();this.filter=[]},removeFilter:function(t){for(var e=this.filter,n=[],i=0;i<e.length;i++)e[i].tag&&e[i].tag==t||t===e[i]?e[i].destroy&&e[i].destroy():n.push(e[i]);this.filter=n},runFilters:function(t,e){for(var n=0;n<this.filter.length;n++)t=this.filter[n].filter(t,e,this);return t},endDrag:function(){this.state&&(t(document.body).off(".jcrop"),this.focus(),this.state=null)},startDrag:function(n,i){return this.core,i=i||t(n.target).data("ord"),this.focus(),"move"==i&&this.element.hasClass(this.core.opt.css_nodrag)||(this.state=new e.component.DragState(n,this,i)),!1},allowSelect:function(t){return void 0===t&&(t=this.canSelect),t&&this.canSelect?this.frame.attr("disabled",!1):this.frame.attr("disabled","disabled"),this},allowDrag:function(t){var e=this,n=e.core.opt;return null==t&&(t=e.canDrag),t&&e.canDrag?e.element.removeClass(n.css_nodrag):e.element.addClass(n.css_nodrag),this},allowResize:function(t){var e=this,n=e.core.opt;return null==t&&(t=e.canResize),t&&e.canResize?e.element.removeClass(n.css_noresize):e.element.addClass(n.css_noresize),this},remove:function(){this.element.trigger("cropremove",this),this.element.remove()},toBack:function(){this.active=!1,this.element.removeClass("jcrop-current jcrop-focus")},toFront:function(){this.active=!0,this.element.addClass("jcrop-current"),this.callFilterFunction("refresh"),this.refresh()},redraw:function(t){return this.moveTo(t.x,t.y),this.resize(t.w,t.h),this.last=t,this},update:function(t,e){return this.updateRaw(this.core.scale(t),e)},updateRaw:function(t,e){return t=this.runFilters(t,e),this.redraw(t),this.element.trigger("cropmove",[this,this.core.unscale(t)]),this},animateTo:function(t,n){var i=new e.component.Animator(this),r=this.core.scale(e.wrapFromXywh(t));i.animate(r.x,r.y,r.w,r.h,n)},center:function(t){var e=this.get(),n=this.core,i=n.container.width(),r=n.container.height(),o=[(i-e.w)/2,(r-e.h)/2,e.w,e.h];return this[t?"setSelect":"animateTo"](o)},createElement:function(e,n){return t("<div />").addClass(e+" ord-"+n).data("ord",n)},moveTo:function(t,e){this.element.css({top:e+"px",left:t+"px"})},blur:function(){return this.element.blur(),this},focus:function(){return this.core.setSelection(this),this.frame.focus(),this},resize:function(t,e){this.element.css({width:t+"px",height:e+"px"})},get:function(){var t=this.element,e=t.position(),n=t.width(),i=t.height(),r={x:e.left,y:e.top};return r.x2=r.x+n,r.y2=r.y+i,r.w=n,r.h=i,r},insertElements:function(){var t,e=this,n=(e.core,e.element),i=e.core.opt,r=i.borders,o=i.handles,s=i.dragbars;for(t=0;t<s.length;t++)n.append(e.createElement(i.css_dragbars,s[t]));for(t=0;t<o.length;t++)n.append(e.createElement(i.css_handles,o[t]));for(t=0;t<r.length;t++)n.append(e.createElement(i.css_borders,r[t]))}}}),e.registerComponent("Selection",b);var x=function(e,n){t.extend(this,x.defaults,n||{}),this.manager=e,this.core=e.core};x.defaults={offset:[-8,-8],active:!0,minsize:[20,20]},t.extend(x.prototype,{start:function(n){var i=this.core;if(i.opt.allowSelect){if(i.opt.multi&&i.opt.multiMax&&i.ui.multi.length>=i.opt.multiMax)return!1;var r=t(n.currentTarget).offset(),o=n.pageX-r.left+this.offset[0],s=n.pageY-r.top+this.offset[1],a=i.ui.multi;if(!i.opt.multi)if(i.opt.multiCleanup){for(var u=0;u<a.length;u++)a[u].remove();i.ui.multi=[]}else i.removeSelection(i.ui.selection);i.container.addClass("jcrop-dragging");var c=i.newSelection().updateRaw(e.wrapFromXywh([o,s,1,1]));return c.element.trigger("cropstart",[c,this.core.unscale(c.get())]),c.startDrag(n,"se")}},end:function(t,e){this.drag(t,e);var n=this.sel.get();this.core.container.removeClass("jcrop-dragging"),n.w<this.minsize[0]||n.h<this.minsize[1]?this.core.requestDelete():this.sel.focus()}}),e.registerComponent("StageDrag",x);var _=function(t){this.core=t,this.ui=t.ui,this.init()};t.extend(_.prototype,{init:function(){this.setupEvents(),this.dragger=new x(this)},tellConfigUpdate:function(t){for(var e=0,n=this.ui.multi,i=n.length;e<i;e++)n[e].setOptions&&(n[e].linked||this.core.opt.linkCurrent&&n[e]==this.ui.selection)&&n[e].setOptions(t)},startDragHandler:function(){var t=this;return function(e){return!e.button||t.core.opt.is_ie_lt9?t.dragger.start(e):void 0}},removeEvents:function(){this.core.event.off(".jcrop-stage"),this.core.container.off(".jcrop-stage")},shimLegacyHandlers:function(e){var n,i=this.core;t.each(i.opt.legacyHandlers,function(t,r){t in e&&(n=e[t],i.container.off(".jcrop-"+t).on(r+".jcrop.jcrop-"+t,function(t,e,r){n.call(i,r)}),delete e[t])})},setupEvents:function(){var t=this,e=t.core;e.event.on("configupdate.jcrop-stage",function(n){t.shimLegacyHandlers(e.opt),t.tellConfigUpdate(e.opt),e.container.trigger("cropconfig",[e,e.opt])}),this.core.container.on("mousedown.jcrop.jcrop-stage",this.startDragHandler())}}),e.registerComponent("StageManager",_);var S=function(){};t.extend(S,{defaults:{selection:null,fading:!0,fadeDelay:1e3,fadeDuration:1e3,autoHide:!1,width:80,height:80,_hiding:null},prototype:{recopyCanvas:function(){var t=this.core.ui.stage,e=t.context;this.context.putImageData(e.getImageData(0,0,t.canvas.width,t.canvas.height),0,0)},init:function(e,n){var i=this;this.core=e,t.extend(this,S.defaults,n),i.initEvents(),i.refresh(),i.insertElements(),i.selection?(i.renderSelection(i.selection),i.selectionTarget=i.selection.element[0]):i.core.ui.selection&&i.renderSelection(i.core.ui.selection),i.core.ui.stage.canvas&&(i.context=i.preview[0].getContext("2d"),i.core.container.on("cropredraw",function(t){i.recopyCanvas(),i.refresh()}))},updateImage:function(e){return this.preview.remove(),this.preview=t(t.Jcrop.imageClone(e)),this.element.append(this.preview),this.refresh(),this},insertElements:function(){this.preview=t(t.Jcrop.imageClone(this.core.ui.stage.imgsrc)),this.element=t("<div />").addClass("jcrop-thumb").width(this.width).height(this.height).append(this.preview).appendTo(this.core.container)},resize:function(t,e){this.width=t,this.height=e,this.element.width(t).height(e),this.renderCoords(this.last)},refresh:function(){this.cw=this.core.opt.xscale*this.core.container.width(),this.ch=this.core.opt.yscale*this.core.container.height(),this.last&&this.renderCoords(this.last)},renderCoords:function(t){var e=this.width/t.w,n=this.height/t.h;return this.preview.css({width:Math.round(e*this.cw)+"px",height:Math.round(n*this.ch)+"px",marginLeft:"-"+Math.round(e*t.x)+"px",marginTop:"-"+Math.round(n*t.y)+"px"}),this.last=t,this},renderSelection:function(t){return this.renderCoords(t.core.unscale(t.get()))},selectionStart:function(t){this.renderSelection(t)},show:function(){this._hiding&&clearTimeout(this._hiding),this.fading?this.element.stop().animate({opacity:1},{duration:80,queue:!1}):this.element.stop().css({opacity:1})},hide:function(){var t=this;t.fading?t._hiding=setTimeout(function(){t._hiding=null,t.element.stop().animate({opacity:0},{duration:t.fadeDuration,queue:!1})},t.fadeDelay):t.element.hide()},initEvents:function(){var t=this;t.core.container.on("croprotstart croprotend cropimage cropstart cropmove cropend",function(e,n,i){if(t.selectionTarget&&t.selectionTarget!==e.target)return!1;switch(e.type){case"cropimage":t.updateImage(i);break;case"cropstart":t.selectionStart(n);case"croprotstart":t.show();break;case"cropend":t.renderCoords(i);case"croprotend":t.autoHide&&t.hide();break;case"cropmove":t.renderCoords(i)}})}}}),e.registerComponent("Thumbnailer",S);var C=function(){};C.prototype={init:function(e,n,i){n||(n=e.container),this.$btn=t(n),this.$targ=t(n),this.core=e,this.$btn.addClass("dialdrag").on("mousedown.dialdrag",this.mousedown()).data("dialdrag",this),t.isFunction(i)||(i=function(){}),this.callback=i,this.ondone=i},remove:function(){return this.$btn.removeClass("dialdrag").off(".dialdrag").data("dialdrag",null),this},setTarget:function(e){return this.$targ=t(e),this},getOffset:function(){var t=this.$targ,e=t.offset();return[e.left+t.width()/2,e.top+t.height()/2]},relMouse:function(t){var e=t.pageX-this.offset[0],n=t.pageY-this.offset[1];return[e,n,Math.atan2(n,e)*(180/Math.PI),Math.sqrt(Math.pow(e,2)+Math.pow(n,2))]},mousedown:function(){function e(e){t(window).off(".dialdrag"),i.ondone.call(i,i.relMouse(e)),i.core.container.trigger("croprotend")}function n(t){i.callback.call(i,i.relMouse(t))}var i=this;return function(r){i.offset=i.getOffset();var o=i.relMouse(r);return i.angleOffset=-i.core.ui.stage.angle+o[2],i.distOffset=o[3],i.dragOffset=[o[0],o[1]],i.core.container.trigger("croprotstart"),t(window).on("mousemove.dialdrag",n).on("mouseup.dialdrag",e),i.callback.call(i,i.relMouse(r)),!1}}},e.registerComponent("DialDrag",C),e.defaults={edge:{n:0,s:0,e:0,w:0},setSelect:null,linked:!0,linkCurrent:!0,canDelete:!0,canSelect:!0,canDrag:!0,canResize:!0,eventManagerComponent:e.component.EventManager,keyboardComponent:e.component.Keyboard,dragstateComponent:e.component.DragState,stagemanagerComponent:e.component.StageManager,animatorComponent:e.component.Animator,selectionComponent:e.component.Selection,stageConstructor:e.stageConstructor,allowSelect:!0,multi:!1,multiMax:!1,multiCleanup:!0,animation:!0,animEasing:"swing",animDuration:400,fading:!0,fadeDuration:300,fadeEasing:"swing",bgColor:"black",bgOpacity:.5,applyFilters:["constrain","extent","backoff","ratio","shader","round"],borders:["e","w","s","n"],handles:["n","s","e","w","sw","ne","nw","se"],dragbars:["n","e","w","s"],dragEventTarget:window,xscale:1,yscale:1,boxWidth:null,boxHeight:null,css_nodrag:"jcrop-nodrag",css_drag:"jcrop-drag",css_container:"jcrop-active",css_shades:"jcrop-shades",css_selection:"jcrop-selection",css_borders:"jcrop-border",css_handles:"jcrop-handle jcrop-drag",css_button:"jcrop-box jcrop-drag",css_noresize:"jcrop-noresize",css_dragbars:"jcrop-dragbar jcrop-drag",legacyHandlers:{onChange:"cropmove",onSelect:"cropend"}},t.extend(e.prototype,{init:function(){this.event=new this.opt.eventManagerComponent(this),this.ui.keyboard=new this.opt.keyboardComponent(this),this.ui.manager=new this.opt.stagemanagerComponent(this),this.applyFilters(),t.Jcrop.supportsTouch&&new t.Jcrop.component.Touch(this),this.initEvents()},applySizeConstraints:function(){var n=this.opt,i=this.opt.imgsrc;if(i){var r=i.naturalWidth||i.width,o=i.naturalHeight||i.height,s=n.boxWidth||r,a=n.boxHeight||o;if(i&&(s<r||a<o)){var u=e.getLargestBox(r/o,s,a);t(i).width(u[0]).height(u[1]),this.resizeContainer(u[0],u[1]),this.opt.xscale=r/u[0],this.opt.yscale=o/u[1]}}if(this.opt.trueSize){var c=this.opt.trueSize[0],l=this.opt.trueSize[1],h=this.getContainerSize();this.opt.xscale=c/h[0],this.opt.yscale=l/h[1]}},initComponent:function(t){if(e.component[t]){var n=Array.prototype.slice.call(arguments),i=new e.component[t];return n.shift(),n.unshift(this),i.init.apply(i,n),i}},setOptions:function(e,n){return t.isPlainObject(e)||(e={}),t.extend(this.opt,e),this.opt.setSelect&&(this.ui.multi.length||this.newSelection(),this.setSelect(this.opt.setSelect),this.opt.setSelect=null),this.event.trigger("configupdate"),this},destroy:function(){this.opt.imgsrc?(this.container.before(this.opt.imgsrc),this.container.remove(),t(this.opt.imgsrc).removeData("Jcrop").show()):this.container.remove()},applyFilters:function(){for(var e,n=0,i=this.opt.applyFilters,r=i.length;n<r;n++)t.Jcrop.filter[i[n]]&&(e=new t.Jcrop.filter[i[n]]),e.core=this,e.init&&e.init(),this.filter[i[n]]=e},getDefaultFilters:function(){for(var t=[],e=0,n=this.opt.applyFilters,i=n.length;e<i;e++)this.filter.hasOwnProperty(n[e])&&t.push(this.filter[n[e]]);return t.sort(function(t,e){return t.priority-e.priority}),t},setSelection:function(t){for(var e=this.ui.multi,n=[],i=0;i<e.length;i++)e[i]!==t&&n.push(e[i]),e[i].toBack();return n.unshift(t),this.ui.multi=n,(this.ui.selection=t).toFront(),t},getSelection:function(t){return this.ui.selection.get()},newSelection:function(t){return t||(t=new this.opt.selectionComponent),t.init(this),this.setSelection(t),t},hasSelection:function(t){for(var e=0;e<this.ui.multi;e++)if(t===this.ui.multi[e])return!0},removeSelection:function(t){for(var e=[],n=this.ui.multi,i=0;i<n.length;i++)t!==n[i]?e.push(n[i]):n[i].remove();return this.ui.multi=e},addFilter:function(t){for(var e=0,n=this.ui.multi,i=n.length;e<i;e++)n[e].addFilter(t);return this},removeFilter:function(t){for(var e=0,n=this.ui.multi,i=n.length;e<i;e++)n[e].removeFilter(t);return this},blur:function(){return this.ui.selection.blur(),this},focus:function(){return this.ui.selection.focus(),this},initEvents:function(){this.container.on("selectstart",function(t){return!1}).on("mousedown","."+this.opt.css_drag,this.startDrag())},maxSelect:function(){this.setSelect([0,0,this.elw,this.elh])},nudge:function(t,e){var n=this.ui.selection,i=n.get();i.x+=t,i.x2+=t,i.y+=e,i.y2+=e,i.x<0?(i.x2=i.w,i.x=0):i.x2>this.elw&&(i.x2=this.elw,i.x=i.x2-i.w),i.y<0?(i.y2=i.h,i.y=0):i.y2>this.elh&&(i.y2=this.elh,i.y=i.y2-i.h),n.element.trigger("cropstart",[n,this.unscale(i)]),n.updateRaw(i,"move"),n.element.trigger("cropend",[n,this.unscale(i)])},refresh:function(){for(var t=0,e=this.ui.multi,n=e.length;t<n;t++)e[t].refresh()},blurAll:function(){for(var t=this.ui.multi,e=0;e<t.length;e++)t[e]!==sel&&n.push(t[e]),t[e].toBack()},scale:function(t){var e=this.opt.xscale,n=this.opt.yscale;return{x:t.x/e,y:t.y/n,x2:t.x2/e,y2:t.y2/n,w:t.w/e,h:t.h/n}},unscale:function(t){var e=this.opt.xscale,n=this.opt.yscale;return{x:t.x*e,y:t.y*n,x2:t.x2*e,y2:t.y2*n,w:t.w*e,h:t.h*n}},requestDelete:function(){return 1<this.ui.multi.length&&this.ui.selection.canDelete?this.deleteSelection():void 0},deleteSelection:function(){this.ui.selection&&(this.removeSelection(this.ui.selection),this.ui.multi.length&&this.ui.multi[0].focus(),this.ui.selection.refresh())},animateTo:function(t){return this.ui.selection&&this.ui.selection.animateTo(t),this},setSelect:function(t){return this.ui.selection&&this.ui.selection.update(e.wrapFromXywh(t)),this},startDrag:function(){var e=this;return function(n){var i=t(n.target),r=i.closest("."+e.opt.css_selection).data("selection"),o=i.data("ord");return e.container.trigger("cropstart",[r,e.unscale(r.get())]),r.startDrag(n,o),!1}},getContainerSize:function(){return[this.container.width(),this.container.height()]},resizeContainer:function(t,e){this.container.width(t).height(e),this.refresh()},setImage:function(e,n){var i=this,r=i.opt.imgsrc;return!!r&&void new t.Jcrop.component.ImageLoader(e,null,function(o,s){i.resizeContainer(o,s),r.src=e,t(r).width(o).height(s),i.applySizeConstraints(),i.refresh(),i.container.trigger("cropimage",[i,r]),"function"==typeof n&&n.call(i,o,s)})},update:function(t){this.ui.selection&&this.ui.selection.update(t)}}),t.fn.Jcrop=function(e,n){e=e||{};var i=this.eq(0).data("Jcrop"),r=Array.prototype.slice.call(arguments);return"api"==e?i:i&&"string"==typeof e?!!i[e]&&(r.shift(),i[e].apply(i,r),i):void this.each(function(){var i=t(this),r=i.data("Jcrop");return r?r.setOptions(e):(e.stageConstructor||(e.stageConstructor=t.Jcrop.stageConstructor),e.stageConstructor(this,e,function(e,r){var o=r.setSelect;o&&delete r.setSelect;var s=t.Jcrop.attach(e.element,r);"function"==typeof e.attach&&e.attach(s),i.data("Jcrop",s),o&&(s.newSelection(),s.setSelect(o)),"function"==typeof n&&n.call(s)})),this})};var E,R=function(t,e,n){function i(t,e){return typeof t===e}function r(t,e){for(var i in t){var r=t[i];if(!~(""+r).indexOf("-")&&p[r]!==n)return"pfx"!=e||r}return!1}function o(t,e,o){var s=t.charAt(0).toUpperCase()+t.slice(1),a=(t+" "+v.join(s+" ")+s).split(" ");return i(e,"string")||i(e,"undefined")?r(a,e):function(t,e,r){for(var o in t){var s=e[t[o]];if(s!==n)return!1===r?t[o]:i(s,"function")?s.bind(r||e):s}return!1}(a=(t+" "+y.join(s+" ")+s).split(" "),e,o)}var s,a,u,c={},l=e.documentElement,h="modernizr",f=e.createElement(h),p=f.style,d={}.toString,g=" -webkit- -moz- -o- -ms- ".split(" "),m="Webkit Moz O ms",v=m.split(" "),y=m.toLowerCase().split(" "),w="http://www.w3.org/2000/svg",b={},x=[],_=x.slice,S=function(t,n,i,r){var o,s,a,u,c=e.createElement("div"),f=e.body,p=f||e.createElement("body");if(parseInt(i,10))for(;i--;)(a=e.createElement("div")).id=r?r[i]:h+(i+1),c.appendChild(a);return o=["&#173;",'<style id="s',h,'">',t,"</style>"].join(""),c.id=h,(f?c:p).innerHTML+=o,p.appendChild(c),f||(p.style.background="",p.style.overflow="hidden",u=l.style.overflow,l.style.overflow="hidden",l.appendChild(p)),s=n(c,t),f?c.parentNode.removeChild(c):(p.parentNode.removeChild(p),l.style.overflow=u),!!s},C=(u={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"},function(t,r){r=r||e.createElement(u[t]||"div");var o=(t="on"+t)in r;return o||(r.setAttribute||(r=e.createElement("div")),r.setAttribute&&r.removeAttribute&&(r.setAttribute(t,""),o=i(r[t],"function"),i(r[t],"undefined")||(r[t]=n),r.removeAttribute(t))),r=null,o}),E={}.hasOwnProperty;for(var R in a=i(E,"undefined")||i(E.call,"undefined")?function(t,e){return e in t&&i(t.constructor.prototype[e],"undefined")}:function(t,e){return E.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var n=_.call(arguments,1),i=function(){if(this instanceof i){var r=function(){};r.prototype=e.prototype;var o=new r,s=e.apply(o,n.concat(_.call(arguments)));return Object(s)===s?s:o}return e.apply(t,n.concat(_.call(arguments)))};return i}),b.canvas=function(){var t=e.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},b.canvastext=function(){return!(!c.canvas||!i(e.createElement("canvas").getContext("2d").fillText,"function"))},b.touch=function(){var n;return"ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch?n=!0:S(["@media (",g.join("touch-enabled),("),h,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(t){n=9===t.offsetTop}),n},b.draganddrop=function(){var t=e.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t},b.csstransforms=function(){return!!o("transform")},b.svg=function(){return!!e.createElementNS&&!!e.createElementNS(w,"svg").createSVGRect},b.inlinesvg=function(){var t=e.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==w},b.svgclippaths=function(){return!!e.createElementNS&&/SVGClipPath/.test(d.call(e.createElementNS(w,"clipPath")))},b)a(b,R)&&(s=R.toLowerCase(),c[s]=b[R](),x.push((c[s]?"":"no-")+s));return c.addTest=function(t,e){if("object"==typeof t)for(var i in t)a(t,i)&&c.addTest(i,t[i]);else{if(t=t.toLowerCase(),c[t]!==n)return c;e="function"==typeof e?e():e,"undefined"!=typeof enableClasses&&enableClasses&&(l.className+=" "+(e?"":"no-")+t),c[t]=e}return c},"",p.cssText="",f=null,c._version="2.7.1",c._prefixes=g,c._domPrefixes=y,c._cssomPrefixes=v,c.hasEvent=C,c.testProp=function(t){return r([t])},c.testAllProps=o,c.testStyles=S,c}(window,window.document);(E=new Image).onerror=function(){R.addTest("datauri",function(){return!1})},E.onload=function(){R.addTest("datauri",function(){return 1==E.width&&1==E.height})},E.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",t.Jcrop=e,t.Jcrop.supportsCanvas=R.canvas,t.Jcrop.supportsCanvasText=R.canvastext,t.Jcrop.supportsDragAndDrop=R.draganddrop,t.Jcrop.supportsDataURI=R.datauri,t.Jcrop.supportsSVG=R.svg,t.Jcrop.supportsInlineSVG=R.inlinesvg,t.Jcrop.supportsSVGClipPaths=R.svgclippaths,t.Jcrop.supportsCSSTransforms=R.csstransforms,t.Jcrop.supportsTouch=R.touch}(jQuery)}]);